# PROJECT-DOC вЂ” РџСЂРѕРґСѓРєС‚РѕРІС‹Рµ РїСЂР°РІРёР»Р° (SSoT РїРѕСЃР»Рµ api-contracts.yaml Рё PROJECT-RULES.md)

## РќР°Р·РЅР°С‡РµРЅРёРµ
Р­С‚РѕС‚ РґРѕРєСѓРјРµРЅС‚ С„РёРєСЃРёСЂСѓРµС‚ РїСЂРѕРґСѓРєС‚РѕРІС‹Рµ/Р±РёР·РЅРµСЃвЂ‘РїСЂР°РІРёР»Р°, РєРѕС‚РѕСЂС‹Рµ РќР• РѕРїРёСЃР°РЅС‹ РІ OpenAPIвЂ‘РєРѕРЅС‚СЂР°РєС‚Р°С….
Р¦РµР»СЊ: РёР·Р±РµР¶Р°С‚СЊ РїРѕСЃС‚РѕСЏРЅРЅС‹С… СѓС‚РѕС‡РЅРµРЅРёР№ Рё В«СѓРіР°РґС‹РІР°РЅРёСЏВ» РїСЂР°РІРёР» РїСЂРё СЂР°Р·СЂР°Р±РѕС‚РєРµ backend.

## РћСЃРЅРѕРІРЅРѕР№ РїСЂРѕС†РµСЃСЃ (РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ в†’ РњРѕРґРµСЂР°С‚РѕСЂ в†’ РђРІС‚РѕвЂ‘РґРѕСЃС‚Р°РІРєР°)

### 1) РЎРѕР·РґР°РЅРёРµ Р·Р°РїСЂРѕСЃР° Рё РєР»СЋС‡РµР№
- РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ СЃРѕР·РґР°С‘С‚ Request Рё Р·Р°РґР°С‘С‚ СЃРїРёСЃРѕРє В«РєР»СЋС‡РµР№В» (РїРѕР·РёС†РёР№).
- РљР»СЋС‡Рё РјРѕРіСѓС‚ РІРІРѕРґРёС‚СЊСЃСЏ РІСЂСѓС‡РЅСѓСЋ РёР»Рё РїРѕСЏРІР»СЏС‚СЊСЃСЏ РїРѕСЃР»Рµ СЂР°СЃРїРѕР·РЅР°РІР°РЅРёСЏ С„Р°Р№Р»Р° (РїР»Р°РЅ: РїР°СЂСЃРёРЅРі РЅР° Р±Р°Р·Рµ OpenAI, РєРѕС‚РѕСЂС‹Р№ РїСЂРµРІСЂР°С‰Р°РµС‚ С„Р°Р№Р» РІ РєР»СЋС‡Рё).
- РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РїСЂРѕСЃРјР°С‚СЂРёРІР°РµС‚ СЂР°СЃРїРѕР·РЅР°РЅРЅС‹Рµ РєР»СЋС‡Рё Рё РїРѕРґС‚РІРµСЂР¶РґР°РµС‚, С‡С‚Рѕ Р·Р°РїСЂРѕСЃ РєРѕСЂСЂРµРєС‚РЅС‹Р№.

### 2) Р”РµР№СЃС‚РІРёРµ В«РџРѕР»СѓС‡РёС‚СЊ РєРѕРЅС‚Р°РєС‚С‹ РїРѕСЃС‚Р°РІС‰РёРєРѕРІВ» (Р·Р°РїСѓСЃРє РјР°С‚С‡РёРЅРіР° + СЃРѕР·РґР°РЅРёРµ Р·Р°РґР°С‡Рё РјРѕРґРµСЂР°С‚РѕСЂСѓ)
РљРѕРіРґР° РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РЅР°Р¶РёРјР°РµС‚ В«РџРѕР»СѓС‡РёС‚СЊ РєРѕРЅС‚Р°РєС‚С‹ РїРѕСЃС‚Р°РІС‰РёРєРѕРІВ»:
- РЎРёСЃС‚РµРјР° Р·Р°РїСѓСЃРєР°РµС‚ matching РґР»СЏ РєР°Р¶РґРѕРіРѕ РєР»СЋС‡Р° РїРѕ РёРјРµСЋС‰РёРјСЃСЏ РґР°РЅРЅС‹Рј РІ Р±Р°Р·Рµ.
- РџР°СЂР°Р»Р»РµР»СЊРЅРѕ СЃРёСЃС‚РµРјР° СЃРѕР·РґР°С‘С‚ Moderator Task РґР»СЏ СЌС‚РѕРіРѕ Р·Р°РїСЂРѕСЃР° (Р·Р°РїСЂРѕСЃ вЂњСЂР°Р·Р±РёРІР°РµС‚СЃСЏвЂќ РїРѕ РєР»СЋС‡Р°Рј РґР»СЏ РѕР±СЂР°Р±РѕС‚РєРё).

### 3) РџСЂРѕС†РµСЃСЃ РїР°СЂСЃРёРЅРіР° Сѓ РјРѕРґРµСЂР°С‚РѕСЂР°
- РњРѕРґРµСЂР°С‚РѕСЂ РѕС‚РєСЂС‹РІР°РµС‚ Р·Р°РґР°С‡Сѓ РїРѕ Р·Р°РїСЂРѕСЃСѓ Рё Р·Р°РїСѓСЃРєР°РµС‚ РїР°СЂСЃРµСЂ (РЅР° Р±Р°Р·Рµ РїРѕРёСЃРєРѕРІС‹С… СЃРёСЃС‚РµРј).
- РџР°СЂСЃРµСЂ РїСЂРѕРіРѕРЅСЏРµС‚ РєР°Р¶РґС‹Р№ РєР»СЋС‡ С‡РµСЂРµР· Google Рё Yandex Рё РІРѕР·РІСЂР°С‰Р°РµС‚ СЃРїРёСЃРѕРє URL РґР»СЏ РєР°Р¶РґРѕРіРѕ РєР»СЋС‡Р°.

### 4) РћР±СЂР°Р±РѕС‚РєР° URL Рё РґРѕСЃС‚Р°РІРєР° РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ
Р”Р»СЏ РєР°Р¶РґРѕРіРѕ URL, РєРѕС‚РѕСЂС‹Р№ РІРµСЂРЅСѓР» РїР°СЂСЃРµСЂ:
- Р•СЃР»Рё URL СѓР¶Рµ РµСЃС‚СЊ РІ Р‘Р” Р РѕРЅ вЂњРјРѕРґРµСЂРёСЂРѕРІР°РЅвЂќ (СЃРј. РѕРїСЂРµРґРµР»РµРЅРёРµ РЅРёР¶Рµ),
  С‚Рѕ РєРѕРЅС‚Р°РєС‚ РїРѕСЃС‚Р°РІС‰РёРєР° СЃСЂР°Р·Сѓ РґРѕСЃС‚Р°РІР»СЏРµС‚СЃСЏ РІ Р›Рљ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  Рё СЃРІСЏР·С‹РІР°РµС‚СЃСЏ СЃ СЌС‚РёРј Р·Р°РїСЂРѕСЃРѕРј + РєРѕРЅРєСЂРµС‚РЅС‹Рј РєР»СЋС‡РѕРј, РєРѕС‚РѕСЂС‹Р№ РґР°Р» URL.
- Р•СЃР»Рё URL РЅРѕРІС‹Р№ РёР»Рё РЅРµ РјРѕРґРµСЂРёСЂРѕРІР°РЅ, РѕРЅ РїСЂРѕС…РѕРґРёС‚ РјРѕРґРµСЂР°С†РёСЋ.
  РљР°Рє С‚РѕР»СЊРєРѕ РјРѕРґРµСЂР°С‚РѕСЂ РїРѕРґС‚РІРµСЂР¶РґР°РµС‚ Рё РїСЂРёРІСЏР·С‹РІР°РµС‚ РµРіРѕ Рє РєР»СЋС‡Сѓ вЂ” РєРѕРЅС‚Р°РєС‚ РґРѕСЃС‚Р°РІР»СЏРµС‚СЃСЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ.

## Р§С‚Рѕ РІРёРґРёС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІ Р›Рљ (РєР°СЂС‚РѕС‡РєР° РїРѕСЃС‚Р°РІС‰РёРєР°)
Р”Р»СЏ РєР°Р¶РґРѕРіРѕ РїРѕСЃС‚Р°РІС‰РёРєР°, РґРѕСЃС‚Р°РІР»РµРЅРЅРѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ, РёРЅС‚РµСЂС„РµР№СЃ РґРѕР»Р¶РµРЅ РїРѕРєР°Р·С‹РІР°С‚СЊ РјРёРЅРёРјСѓРј:
- РќР°Р·РІР°РЅРёРµ РєРѕРјРїР°РЅРёРё
- РРќРќ
- URL РєРѕРјРїР°РЅРёРё
- Р”РѕРїРѕР»РЅРёС‚РµР»СЊРЅС‹Рµ СЃРІРµРґРµРЅРёСЏ Рѕ РєРѕРјРїР°РЅРёРё РёР· Checko API (РµСЃР»Рё РґРѕСЃС‚СѓРїРЅС‹)
- Р’РѕР·РјРѕР¶РЅРѕСЃС‚СЊ РѕС‚РїСЂР°РІРёС‚СЊ Р·Р°РїСЂРѕСЃ РїРѕСЃС‚Р°РІС‰РёРєСѓ (РІРµС‚РєР° messaging)

## РћРїСЂРµРґРµР»РµРЅРёРµ: В«РњРѕРґРµСЂРёСЂРѕРІР°РЅРЅС‹Р№ РїРѕСЃС‚Р°РІС‰РёРє / РјРѕРґРµСЂРёСЂРѕРІР°РЅРЅС‹Р№ URLВ» (Р¶С‘СЃС‚РєРѕРµ С‚СЂРµР±РѕРІР°РЅРёРµ)
РљРѕРјРїР°РЅРёСЏ/URL РјРѕР¶РµС‚ С…СЂР°РЅРёС‚СЊСЃСЏ РєР°Рє В«РїСЂРёРіРѕРґРЅС‹Р№ РїРѕСЃС‚Р°РІС‰РёРєВ», С‚РѕР»СЊРєРѕ РµСЃР»Рё РјРѕРґРµСЂР°С‚РѕСЂ РїСЂРёРІСЏР·Р°Р» РјРёРЅРёРјСѓРј РґР°РЅРЅС‹С…:
- URL РєРѕРјРїР°РЅРёРё
- РРќРќ
- РќР°Р·РІР°РЅРёРµ РєРѕРјРїР°РЅРёРё
- Email РѕС‚РґРµР»Р° РїСЂРѕРґР°Р¶ (РєРѕРЅС‚Р°РєС‚РЅС‹Р№ СЏС‰РёРє РґР»СЏ Р·Р°РїСЂРѕСЃРѕРІ)
РўРѕР»СЊРєРѕ РїРѕСЃР»Рµ СЌС‚РѕРіРѕ РїРѕСЃС‚Р°РІС‰РёРє СЃС‡РёС‚Р°РµС‚СЃСЏ РјРѕРґРµСЂРёСЂРѕРІР°РЅРЅС‹Рј Рё РјРѕР¶РµС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РґРѕСЃС‚Р°РІР»СЏС‚СЊСЃСЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏРј.

## РџСЂР°РІРёР»Р° matching: В«РїРѕС…РѕР¶РёР№ РєР»СЋС‡В» (MVP в†’ СѓР»СѓС‡С€РµРЅРёСЏ)

### Р¦РµР»СЊ
Matching РґРѕР»Р¶РµРЅ РІРѕР·РІСЂР°С‰Р°С‚СЊ РґРµР№СЃС‚РІРёС‚РµР»СЊРЅРѕ СЂРµР»РµРІР°РЅС‚РЅС‹С… РїРѕСЃС‚Р°РІС‰РёРєРѕРІ РґР»СЏ РєР»СЋС‡Р°.
РџСЂРёРјРµСЂ: РєР»СЋС‡ В«Р¤Р»Р°РЅРµС† d100В» РґРѕР»Р¶РµРЅ РјР°С‚С‡РёС‚СЊСЃСЏ РЅР° РєР»СЋС‡ РІ Р‘Р” С‚РёРїР° В«Р¤Р»Р°РЅРµС† РїР»РѕСЃРєРёР№ d100В».

### Р РµРєРѕРјРµРЅРґРѕРІР°РЅРЅС‹Р№ РїРѕРґС…РѕРґ РґР»СЏ MVP (РґРµС‚РµСЂРјРёРЅРёСЂРѕРІР°РЅРЅС‹Р№ Рё РѕР±СЉСЏСЃРЅРёРјС‹Р№)
1) РќРѕСЂРјР°Р»РёР·Р°С†РёСЏ С‚РµРєСЃС‚Р° РєР»СЋС‡Р°:
   - РџСЂРёРІРµРґРµРЅРёРµ Рє РЅРёР¶РЅРµРјСѓ СЂРµРіРёСЃС‚СЂСѓ, РѕР±СЂРµР·РєР° РїСЂРѕР±РµР»РѕРІ, СѓРЅРёС„РёРєР°С†РёСЏ СЃРёРјРІРѕР»РѕРІ (РЅР°РїСЂРёРјРµСЂ d/Гё/Рґ), РЅРѕСЂРјР°Р»РёР·Р°С†РёСЏ В«С‘/РµВ».
   - Р§РёСЃР»РѕРІС‹Рµ/СЂР°Р·РјРµСЂРЅС‹Рµ С‚РѕРєРµРЅС‹ СЃС‡РёС‚Р°СЋС‚СЃСЏ РІР°Р¶РЅС‹РјРё (РЅР°РїСЂРёРјРµСЂ 100).
2) РР·РІР»РµС‡РµРЅРёРµ В«РѕР±СЏР·Р°С‚РµР»СЊРЅС‹С… РїР°СЂР°РјРµС‚СЂРѕРІВ»:
   - Р Р°Р·РјРµСЂС‹/РґРёР°РјРµС‚СЂС‹ (d=100), Р“РћРЎРў, РјР°СЂРєР° СЃС‚Р°Р»Рё Рё С‚.Рї. (РїРѕ С€Р°Р±Р»РѕРЅР°Рј).
3) Р РµС€РµРЅРёРµ Рѕ СЃРѕРІРїР°РґРµРЅРёРё:
   - РћР±СЏР·Р°С‚РµР»СЊРЅС‹Рµ РїР°СЂР°РјРµС‚СЂС‹ РґРѕР»Р¶РЅС‹ СЃРѕРІРїР°СЃС‚СЊ (РЅР°РїСЂРёРјРµСЂ d=100).
   - РўРµРєСЃС‚РѕРІР°СЏ РїРѕС…РѕР¶РµСЃС‚СЊ РґРѕР»Р¶РЅР° Р±С‹С‚СЊ РІС‹С€Рµ РїРѕСЂРѕРіР° (РІР°СЂРёР°РЅС‚С‹: РїРµСЂРµСЃРµС‡РµРЅРёРµ С‚РѕРєРµРЅРѕРІ РёР»Рё trigram similarity).
4) РћР±СЉСЏСЃРЅРёРјРѕСЃС‚СЊ:
   - РҐСЂР°РЅРёРј вЂњРїРѕС‡РµРјСѓ СЃРѕРІРїР°Р»РѕвЂќ (РєР°РєРёРµ РїР°СЂР°РјРµС‚СЂС‹ Рё С‚РѕРєРµРЅС‹ СЃРѕРІРїР°Р»Рё), С‡С‚РѕР±С‹ matching РЅРµ Р±С‹Р» вЂњС‡С‘СЂРЅС‹Рј СЏС‰РёРєРѕРјвЂќ.

### РџСЂРёРјРµС‡Р°РЅРёСЏ
- РџРѕСЂРѕРіРё Рё С‚РѕС‡РЅС‹Р№ Р°Р»РіРѕСЂРёС‚Рј Р±СѓРґСѓС‚ С‚СЋРЅРёС‚СЊСЃСЏ РїРѕ СЂРµР°Р»СЊРЅС‹Рј РґР°РЅРЅС‹Рј.
- Р’ MVP РёР·Р±РµРіР°РµРј ML/blackвЂ‘box; РЅР°С‡РёРЅР°РµРј СЃ РґРµС‚РµСЂРјРёРЅРёСЂРѕРІР°РЅРЅРѕРіРѕ matching.

## РўСЂРµР±РѕРІР°РЅРёСЏ Рє СЃРІСЏР·СЏРј РґР°РЅРЅС‹С… (РєРѕРЅС†РµРїС‚СѓР°Р»СЊРЅРѕ)
- РљР°Р¶РґС‹Р№ РґРѕСЃС‚Р°РІР»РµРЅРЅС‹Р№ РїРѕСЃС‚Р°РІС‰РёРє РґРѕР»Р¶РµРЅ Р±С‹С‚СЊ СЃРІСЏР·Р°РЅ СЃ:
  - Р—Р°РїСЂРѕСЃРѕРј (requestId)
  - РљР»СЋС‡РѕРј (keyId/pos), РєРѕС‚РѕСЂС‹Р№ РїСЂРёРІС‘Р» Рє РїРѕСЃС‚Р°РІС‰РёРєСѓ
  - Source URL (Рё РїСЂРёР·РЅР°РєРѕРј: URL Р±С‹Р» РёР·РІРµСЃС‚РµРЅ РІ Р‘Р” РёР»Рё РЅР°Р№РґРµРЅ РїР°СЂСЃРµСЂРѕРј)

## РћС‚РєСЂС‹С‚С‹Рµ РІРѕРїСЂРѕСЃС‹ (СЂРµС€РёРј РїРѕР·Р¶Рµ, MVP РЅРµ Р±Р»РѕРєРёСЂСѓСЋС‚)
- РљР°Рє РєРµС€РёСЂСѓСЋС‚СЃСЏ Рё РѕР±РЅРѕРІР»СЏСЋС‚СЃСЏ РґР°РЅРЅС‹Рµ Checko API.
- РўРѕС‡РЅС‹Р№ UI РєР°СЂС‚РѕС‡РєРё РїРѕСЃС‚Р°РІС‰РёРєР° (РјРёРЅРёРјР°Р»СЊРЅС‹Р№ РЅР°Р±РѕСЂ РїРѕР»РµР№ Р·Р°С„РёРєСЃРёСЂРѕРІР°РЅ РІС‹С€Рµ).
- Р”РµС‚Р°Р»Рё РёРЅС‚РµРіСЂР°С†РёРё РїР°СЂСЃРµСЂР° Рё СЌРєСЃРїР»СѓР°С‚Р°С†РёРѕРЅРЅС‹Рµ РѕРіСЂР°РЅРёС‡РµРЅРёСЏ.

## РЎС‚Р°С‚СѓСЃС‹ РїРѕСЃС‚Р°РІС‰РёРєРѕРІ РІ Р›Рљ (MVP)

### РљРѕРіРґР° РїРѕСЃС‚Р°РІС‰РёРє СЃС‡РёС‚Р°РµС‚СЃСЏ вЂњРјРѕРґРµСЂРёСЂРѕРІР°РЅРЅС‹РјвЂќ
РџРѕСЃС‚Р°РІС‰РёРє СЃС‡РёС‚Р°РµС‚СЃСЏ РїСЂРёРіРѕРґРЅС‹Рј РґР»СЏ РІС‹РґР°С‡Рё РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ (РјРѕРґРµСЂРёСЂРѕРІР°РЅРЅС‹Рј), С‚РѕР»СЊРєРѕ РµСЃР»Рё РјРѕРґРµСЂР°С‚РѕСЂ РїСЂРёРІСЏР·Р°Р» РјРёРЅРёРјСѓРј РґР°РЅРЅС‹С…:
- URL РєРѕРјРїР°РЅРёРё
- РРќРќ
- РќР°Р·РІР°РЅРёРµ РєРѕРјРїР°РЅРёРё
- Email РѕС‚РґРµР»Р° РїСЂРѕРґР°Р¶ (РїРѕС‡С‚РѕРІС‹Р№ СЏС‰РёРє, РЅР° РєРѕС‚РѕСЂС‹Р№ РѕС‚РїСЂР°РІР»СЏСЋС‚СЃСЏ Р·Р°РїСЂРѕСЃС‹)

### Р—РЅР°С‡РµРЅРёРµ С†РІРµС‚РѕРІ/СЃС‚Р°С‚СѓСЃРѕРІ
- РЎРµСЂС‹Р№: РРќРќ РїРѕСЃС‚Р°РІС‰РёРєР° РґРѕР±Р°РІР»РµРЅ РїРѕР»СЊР·РѕРІР°С‚РµР»РµРј РІ Р»РёС‡РЅС‹Р№ Р§РЎ. РџРѕСЃС‚Р°РІС‰РёРє РІСЃС‘ СЂР°РІРЅРѕ РїРѕРєР°Р·С‹РІР°РµС‚СЃСЏ РІ РІС‹РґР°С‡Рµ, РЅРѕ С‡РµРєР±РѕРєСЃ вЂњРІС‹РґРµР»РёС‚СЊ Рє РѕС‚РїСЂР°РІРєРµвЂќ РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РІС‹РєР»СЋС‡РµРЅ.
- Р¤РёРѕР»РµС‚РѕРІС‹Р№: РїРѕСЃС‚Р°РІС‰РёРє РїРѕРјРµС‡РµРЅ РєР°Рє вЂњС‚РѕСЂРіСѓСЋС‰Р°СЏ РѕСЂРіР°РЅРёР·Р°С†РёСЏ / РїРµСЂРµРєСѓРївЂќ. Р­С‚Рѕ РіР»РѕР±Р°Р»СЊРЅР°СЏ РјРµС‚РєР° (РґР»СЏ РІСЃРµС… РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№). Р§РµРєР±РѕРєСЃ РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РІС‹РєР»СЋС‡РµРЅ.
- Р–С‘Р»С‚С‹Р№: РЅРѕРІС‹Р№ РїРѕСЃС‚Р°РІС‰РёРє РїРѕСЏРІРёР»СЃСЏ РІ СЂРµР·СѓР»СЊС‚Р°С‚Рµ РїРѕРїРѕР»РЅРµРЅРёСЏ Р±Р°Р·С‹ РїРѕСЃР»Рµ РјРѕРґРµСЂР°С†РёРё. РћСЃС‚Р°С‘С‚СЃСЏ Р¶С‘Р»С‚С‹Рј, РїРѕРєР° РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ Р»РёР±Рѕ СЃРЅРёРјРµС‚ РіР°Р»РѕС‡РєСѓ (СЏРІРЅРѕ вЂњРЅРµ РѕС‚РїСЂР°РІР»СЏС‚СЊвЂќ), Р»РёР±Рѕ РѕС‚РїСЂР°РІРёС‚ Р·Р°РїСЂРѕСЃ.
- РљСЂР°СЃРЅС‹Р№: Р·Р°РїСЂРѕСЃ РЅРµ РѕС‚РїСЂР°РІР»РµРЅ (С‚РёРїРѕРІРѕРµ СЃС‚Р°СЂС‚РѕРІРѕРµ СЃРѕСЃС‚РѕСЏРЅРёРµ РґР»СЏ вЂњРѕР±С‹С‡РЅС‹С…вЂќ РїРѕСЃС‚Р°РІС‰РёРєРѕРІ).
- Р—РµР»С‘РЅС‹Р№: Р·Р°РїСЂРѕСЃ РѕС‚РїСЂР°РІР»РµРЅ.

### РРЅРґРёРєР°С†РёСЏ РѕС‚РІРµС‚Р°
Р”РѕРїРѕР»РЅРёС‚РµР»СЊРЅРѕ РЅСѓР¶РЅР° РёРЅРґРёРєР°С†РёСЏ: РѕС‚РІРµС‚РёР» РїРѕСЃС‚Р°РІС‰РёРє РЅР° Р·Р°РїСЂРѕСЃ РёР»Рё РЅРµС‚ (РѕС‚РІРµС‚РёР» / РЅРµ РѕС‚РІРµС‚РёР»).

### РћРіСЂР°РЅРёС‡РµРЅРёРµ MVP (РїРѕС‡С‚Р° РЅРµ РїРѕРґРєР»СЋС‡РµРЅР°)
РџРѕРєР° РїРѕС‡С‚РѕРІС‹Р№ СЏС‰РёРє РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РЅРµ РёРЅС‚РµРіСЂРёСЂРѕРІР°РЅ РІ Р›Рљ, РѕС‚РїСЂР°РІРєР° РїРёСЃРµРј РёР· СЃРµСЂРІРёСЃР° РЅРµ СЂР°Р±РѕС‚Р°РµС‚ (Р·Р°РіР»СѓС€РєР°).
РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РјРѕР¶РµС‚ С‚РѕР»СЊРєРѕ СЃРєРѕРїРёСЂРѕРІР°С‚СЊ РєРѕРЅС‚Р°РєС‚С‹ РїРѕСЃС‚Р°РІС‰РёРєР° Рё РѕС‚РїСЂР°РІРёС‚СЊ Р·Р°РїСЂРѕСЃ РёР· СЃРІРѕРµР№ РїРѕС‡С‚С‹; СЃС‚Р°С‚СѓСЃС‹ РѕС‚РїСЂР°РІРєРё/РѕС‚РІРµС‚Р° вЂ” Р·Р°РіР»СѓС€РєРё РґРѕ РІРЅРµРґСЂРµРЅРёСЏ РёРЅС‚РµРіСЂР°С†РёРё.

## РџРѕСЃС‚Р°РІС‰РёРєРё: РїРѕРёСЃРє Рё РґРѕСЃС‚СѓРїС‹
- РџРѕРёСЃРє РїРѕСЃС‚Р°РІС‰РёРєРѕРІ РїРѕ СЃС‚СЂРѕРєРµ: РјРѕРґРµСЂР°С‚РѕСЂ РёСЃРїРѕР»СЊР·СѓРµС‚ РІ Р°РґРјРёРЅРєРµ.
- РњРѕРґРµСЂР°С‚РѕСЂ РјРѕР¶РµС‚ РІРєР»СЋС‡Р°С‚СЊ/РІС‹РєР»СЋС‡Р°С‚СЊ РґРѕСЃС‚СѓРїРЅРѕСЃС‚СЊ СЃС‚СЂРѕРєРё РїРѕРёСЃРєР° РґР»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ РёР· СЃРІРѕРµРіРѕ Р›Рљ (С„РёС‡Р°вЂ‘С„Р»Р°Рі).
- РџРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РІ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊСЃРєРѕРј РёРЅС‚РµСЂС„РµР№СЃРµ СЃС‚СЂРѕРєР° РїРѕРёСЃРєР° СЃРєСЂС‹С‚Р° (РїРѕРєР° РјРѕРґРµСЂР°С‚РѕСЂ РЅРµ РІРєР»СЋС‡РёР»).
- Р”Р°РЅРЅС‹Рµ РїРѕСЃС‚Р°РІС‰РёРєР°: РРќРќ СЃС‚СЂРѕРіРѕ РѕРґРёРЅ РЅР° РїРѕСЃС‚Р°РІС‰РёРєР°.
- Р”Р°РЅРЅС‹Рµ РїРѕСЃС‚Р°РІС‰РёРєР°: URL Сѓ РїРѕСЃС‚Р°РІС‰РёРєР° РјРѕР¶РµС‚ Р±С‹С‚СЊ РЅРµСЃРєРѕР»СЊРєРѕ (СЂРµРґРєРѕ, РЅРѕ РІРѕР·РјРѕР¶РЅРѕ).
- РЈРЅРёРєР°Р»СЊРЅРѕСЃС‚СЊ URL: РѕРґРёРЅ СЃР°Р№С‚ (URL) РЅРµ РјРѕР¶РµС‚ РїСЂРёРЅР°РґР»РµР¶Р°С‚СЊ РґРІСѓРј РїРѕСЃС‚Р°РІС‰РёРєР°Рј (РіР»РѕР±Р°Р»СЊРЅР°СЏ СѓРЅРёРєР°Р»СЊРЅРѕСЃС‚СЊ).

## Р”СѓР±Р»Рё РїРѕ РРќРќ (ModeratorSuppliers)
Р•СЃР»Рё РјРѕРґРµСЂР°С‚РѕСЂ РїС‹С‚Р°РµС‚СЃСЏ СЃРѕР·РґР°С‚СЊ РїРѕСЃС‚Р°РІС‰РёРєР° СЃ РРќРќ, РєРѕС‚РѕСЂС‹Р№ СѓР¶Рµ СЃСѓС‰РµСЃС‚РІСѓРµС‚ РІ Р±Р°Р·Рµ, СЃРѕР·РґР°РЅРёРµ Р±Р»РѕРєРёСЂСѓРµС‚СЃСЏ.

API: POST /apiv1/moderator/suppliers РІРѕР·РІСЂР°С‰Р°РµС‚ 409 Duplicate INN СЃ С‚РµР»РѕРј DuplicateInnErrorDTO.

UI: РѕС‚РєСЂС‹РІР°РµС‚СЃСЏ СЌРєСЂР°РЅ СЃСЂР°РІРЅРµРЅРёСЏ РґСѓР±Р»РµР№:
- РЎР»РµРІР°: incomingurl (+ РІРІРµРґС‘РЅРЅС‹Р№ РРќРќ/РЅР°Р·РІР°РЅРёРµ РµСЃР»Рё РµСЃС‚СЊ)
- РЎРїСЂР°РІР°: СЃСѓС‰РµСЃС‚РІСѓСЋС‰Р°СЏ РєРѕРјРїР°РЅРёСЏ (supplierid, name) Рё РІСЃРµ РµС‘ urls (РєР»РёРєР°Р±РµР»СЊРЅС‹Рµ, РѕС‚РєСЂС‹РІР°СЋС‚СЃСЏ РІ РЅРѕРІРѕР№ РІРєР»Р°РґРєРµ)
- Р”РµР№СЃС‚РІРёРµ: С‚РѕР»СЊРєРѕ вЂњРїРµСЂРµР№С‚Рё РІ РєР°СЂС‚РѕС‡РєСѓ РїСЂРµРґРїСЂРёСЏС‚РёСЏвЂќ

## РњРѕРґРµСЂР°С†РёСЏ СЂРµР·СѓР»СЊС‚Р°С‚РѕРІ РїР°СЂСЃРёРЅРіР°: Blacklist vs РџРµСЂРµРєСѓРїС‰РёРєРё vs Р“Р°Р»РѕС‡РєРё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ

### РћР±С‰Р°СЏ СЃС…РµРјР° РїСЂРѕС†РµСЃСЃР°
1. РњРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ Р·Р°СЏРІРєСѓ СЃ РїРѕР·РёС†РёСЏРјРё (РєР»СЋС‡Р°РјРё).
2. РќР°Р¶РёРјР°РµС‚ "Р—Р°РїСѓСЃС‚РёС‚СЊ РїР°СЂСЃРёРЅРі".
3. Р”Р»СЏ РєР°Р¶РґРѕР№ РїРѕР·РёС†РёРё РїР°СЂР°Р»Р»РµР»СЊРЅРѕ:
   - РџР°СЂСЃРµСЂ РІРІРѕРґРёС‚ "РєР»СЋС‡ + РєСѓРїРёС‚СЊ" в†’ РЇРЅРґРµРєСЃ РњР°СЂРєРµС‚ / Google.
   - РџРѕР»СѓС‡Р°РµС‚ СЃРїРёСЃРѕРє URL (СЂРµР·СѓР»СЊС‚Р°С‚С‹ РїРѕРёСЃРєР°).
   - Р’С‹С‚Р°СЃРєРёРІР°РµС‚: РґРѕРјРµРЅ, РєРѕРјРїР°РЅРёСЋ РёР· РјРµС‚Р°-С‚РµРіРѕРІ.
4. РњРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ СЃРїРёСЃРѕРє URL Рё РІСЂСѓС‡РЅСѓСЋ РјРѕРґРµСЂРёСЂСѓРµС‚ РєР°Р¶РґС‹Р№:
   - вњ… Р—РµР»С‘РЅС‹Р№ (РїРѕСЃС‚Р°РІС‰РёРє) в†’ СѓС‚РѕС‡РЅСЏРµС‚ РРќРќ, Р·Р°РїСЂР°С€РёРІР°РµС‚ РёРЅС„Рѕ РёР· Checko API в†’ РґРѕР±Р°РІР»СЏРµС‚ РІ Р±Р°Р·Сѓ РїРѕСЃС‚Р°РІС‰РёРєРѕРІ в†’ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ РІ Р›Рљ.
   - рџџЎ Р–С‘Р»С‚С‹Р№ (РґРѕРї.РјРѕРґРµСЂР°С†РёСЏ) в†’ РЅСѓР¶РЅРѕ РїСЂРѕРІРµСЂРёС‚СЊ Р»РёС‡РЅРѕ, РѕС‚Р»РѕР¶РµРЅРѕ.
   - рџ”ґ Р§С‘СЂРЅС‹Р№ (СЃРїР°Рј) в†’ РѕС‚РєР»РѕРЅРёС‚СЊ, РґРѕР±Р°РІРёС‚СЊ РґРѕРјРµРЅ РІ Blacklist (СЃРј. РЅРёР¶Рµ).
   - вљ«пёЏ РџРµСЂРµРєСѓРїС‰РёРє в†’ СЃРјРѕРґРµСЂРёСЂРѕРІР°С‚СЊ РєР°Рє РїРѕСЃС‚Р°РІС‰РёРє, РЅРѕ РїРѕРјРµС‚РёС‚СЊ РѕС‚РґРµР»СЊРЅС‹Рј С„Р»Р°РіРѕРј "reseller" в†’ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ РІ Р›Рљ СЃ РјРµС‚РєРѕР№ "РџРµСЂРµРєСѓРїС‰РёРє".

### Moderator Blacklist (С‡С‘СЂРЅС‹Р№ СЃРїРёСЃРѕРє СЃРїР°Рј-РґРѕРјРµРЅРѕРІ)
- "Р§С‘СЂРЅС‹Р№" РІ РјРѕРґРµСЂР°С†РёРё = Blacklist (РіР»РѕР±Р°Р»СЊРЅС‹Р№ СЃРїРёСЃРѕРє СЃРїР°Рј-РґРѕРјРµРЅРѕРІ).
- Р’ Blacklist С…СЂР°РЅРёС‚СЃСЏ **РєРѕСЂРЅРµРІРѕР№ РґРѕРјРµРЅ** (РїСЂРёРјРµСЂ: pulscen.ru).
- РџСЂР°РІРёР»Рѕ Р±Р°РЅР°: РєРѕСЂРЅРµРІРѕР№ РґРѕРјРµРЅ Р±Р»РѕРєРёСЂСѓРµС‚ СЃР°Рј РґРѕРјРµРЅ Рё **Р»СЋР±С‹Рµ РїРѕРґРґРѕРјРµРЅС‹** (spb.pulscen.ru, msk.pulscen.ru Рё С‚.Рґ.).
- UI РјРѕРґРµСЂР°С‚РѕСЂР° РїРѕРєР°Р·С‹РІР°РµС‚ РєРѕСЂРЅРµРІРѕР№ РґРѕРјРµРЅ, Р° РїСЂРё СЂР°СЃРєСЂС‹С‚РёРё "РіР°СЂРјРѕС€РєРё" РІРёРґРЅРѕ РІСЃРµ РїРѕРґРґРѕРјРµРЅС‹, РєРѕС‚РѕСЂС‹Рµ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РїРѕРґС‚СЏРЅСѓР»РёСЃСЊ.
- Р•СЃР»Рё URL РїРѕРїР°Р» РїРѕРґ Blacklist:
  - **РњРѕРґРµСЂР°С‚РѕСЂ РЅРµ РІРёРґРёС‚** РµРіРѕ РІ СЂРµР·СѓР»СЊС‚Р°С‚Р°С… РїР°СЂСЃРёРЅРіР° (С‡С‚РѕР±С‹ РЅРµ РјРµС€Р°Р»СЃСЏ).
  - Р­С‚РѕС‚ URL **РЅРµ РїРѕРїР°РґР°РµС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ** (РЅРµ РґРѕР±Р°РІР»СЏРµС‚СЃСЏ РІ Р±Р°Р·Сѓ РїРѕСЃС‚Р°РІС‰РёРєРѕРІ).
  - URL РѕСЃС‚Р°С‘С‚СЃСЏ С‚РѕР»СЊРєРѕ РІ **Р»РѕРіР°С…/СЃР»СѓР¶РµР±РЅРѕРј СЃРїРёСЃРєРµ** СЃ РїРѕРјРµС‚РєРѕР№: "СЃРєСЂС‹С‚, С‚.Рє. РґРѕРјРµРЅ РІ Р§РЎ (pulscen.ru СЃРѕРІРїР°Р» СЃ spb.pulscen.ru РєР°Рє РїРѕРґРґРѕРјРµРЅ)".

### РџРµСЂРµРєСѓРїС‰РёРєРё (Resellers)
- РџРµСЂРµРєСѓРїС‰РёРє вЂ” **РЅРµ Blacklist**, СЌС‚Рѕ РѕС‚РґРµР»СЊРЅР°СЏ СЃСѓС‰РЅРѕСЃС‚СЊ/Р±Р°Р·Р°.
- URL СЃРјРѕРґРµСЂРёСЂРѕРІР°РЅ Рё РґРѕР±Р°РІР»РµРЅ РІ Р±Р°Р·Сѓ РїРѕСЃС‚Р°РІС‰РёРєРѕРІ, РЅРѕ РїРѕРјРµС‡РµРЅ С„Р»Р°РіРѕРј is_reseller=true (РёР»Рё Р°РЅР°Р»РѕРі).
- **РџРѕРєР°Р·С‹РІР°РµС‚СЃСЏ** Рё РјРѕРґРµСЂР°С‚РѕСЂСѓ (РґР»СЏ СЃРїСЂР°РІРєРё), Рё РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ (РІ Р›Рљ СЃ СЏРІРЅРѕР№ РјРµС‚РєРѕР№ "РџРµСЂРµРєСѓРїС‰РёРє").
- РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ СЃР°Рј СЂРµС€Р°РµС‚, РѕС‚РїСЂР°РІР»СЏС‚СЊ Р»Рё Р·Р°РїСЂРѕСЃ РїРµСЂРµРєСѓРїС‰РёРєСѓ РёР»Рё РЅРµС‚.

### Р“Р°Р»РѕС‡РєРё РІ Р»РёС‡РЅРѕРј РєР°Р±РёРЅРµС‚Рµ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ (Recipients)
- "Р“Р°Р»РѕС‡РєРё" (РІС‹Р±РѕСЂ РїРѕР»СѓС‡Р°С‚РµР»РµР№ Р·Р°РїСЂРѕСЃР°) вЂ” СЌС‚Рѕ РёСЃС‚РѕСЂРёСЏ **Р»РёС‡РЅРѕРіРѕ РєР°Р±РёРЅРµС‚Р° РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ**.
- РџРѕСЃР»Рµ С‚РѕРіРѕ РєР°Рє РјРѕРґРµСЂР°С‚РѕСЂ СЃРјРѕРґРµСЂРёСЂРѕРІР°Р» РїРѕСЃС‚Р°РІС‰РёРєРѕРІ (Р·РµР»С‘РЅС‹Рµ, Р¶С‘Р»С‚С‹Рµ, РїРµСЂРµРєСѓРїС‰РёРєРё), РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ СЃРїРёСЃРѕРє СЂРµР·СѓР»СЊС‚Р°С‚РѕРІ Рё СЂРµС€Р°РµС‚, РєРѕРјСѓ РѕС‚РїСЂР°РІР»СЏС‚СЊ Р·Р°РїСЂРѕСЃ.
- Recipients (РіР°Р»РѕС‡РєРё) = РјР°СЃСЃРёРІ {supplier_id, selected} (С‚РѕР»СЊРєРѕ РІ Р›Рљ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ, РЅРµ РЅР° СЌС‚Р°РїРµ РїР°СЂСЃРёРЅРіР°).

### РџСЂР°РІРёР»Рѕ РґР»СЏ РїРѕРґРґРѕРјРµРЅРѕРІ РїСЂРё РјРѕРґРµСЂР°С†РёРё Рё РїРѕРёСЃРєРµ РІ Р±Р°Р·Рµ
- Р•СЃР»Рё РІ Р±Р°Р·Рµ РїРѕСЃС‚Р°РІС‰РёРєРѕРІ РµСЃС‚СЊ URL РЅР° РєРѕСЂРЅРµРІРѕРј РґРѕРјРµРЅРµ (РЅР°РїСЂРёРјРµСЂ, example.com), С‚Рѕ РїРѕРґРґРѕРјРµРЅС‹ (shop.example.com) СЃС‡РёС‚Р°СЋС‚СЃСЏ **С‚РµРј Р¶Рµ СЃРµРјРµР№СЃС‚РІРѕРј** в†’ РєРѕРЅС‚Р°РєС‚С‹/РёРЅС„Рѕ РїРѕ РєРѕСЂРЅРµРІРѕРјСѓ РґРѕРјРµРЅСѓ РІРѕР·РІСЂР°С‰Р°СЋС‚СЃСЏ Рё РґР»СЏ РїРѕРґРґРѕРјРµРЅР° (РµСЃР»Рё РЅРµС‚ Р±РѕР»РµРµ С‚РѕС‡РЅРѕРіРѕ СЃРѕРІРїР°РґРµРЅРёСЏ).
- Р­С‚Рѕ РїРѕРјРѕРіР°РµС‚ РёР·Р±РµР¶Р°С‚СЊ РґСѓР±Р»РёСЂРѕРІР°РЅРёСЏ Р·Р°РїРёСЃРµР№ РґР»СЏ РѕРґРЅРѕР№ РєРѕРјРїР°РЅРёРё РЅР° СЂР°Р·РЅС‹С… РїРѕРґРґРѕРјРµРЅР°С….
## Parsing: implementation notes (MVP)

### Depth (search pages)
- Depth controls how many search result pages are fetched per key (pages in the search engine), not a max-URL limit.
- The parser stops when it reaches the depth page limit even if more results exist.
- Default depth should be conservative for MVP (e.g., 1-3 pages) to reduce rate limits/captcha risk; tune later based on real usage.

### Domain blacklist (root-domain)
- Blacklist is stored as root domains (e.g., pulscen.ru).
- Root-domain blacklist blocks the domain itself AND all subdomains (e.g., spb.pulscen.ru, msk.pulscen.ru).
- Blacklisted results must be filtered server-side and must not appear in parsing-results at all (moderator should never see them).

### Accordion (domain groups)
- UI shows parsing results grouped by domain (accordion): domain -> list of URLs.
- Grouping is done after blacklist filtering.
- Domain in results may include subdomains; blacklist matching must normalize URL hostname to root-domain for filtering logic.

### Processing pipeline (recommended)
- parser_service: collects raw URLs per key by querying search engines up to Depth pages.
- backend: normalizes domains, applies root-domain blacklist filtering, and groups results by domain before returning them to the moderator endpoints.
## Parsing MVP: depth, blacklist, accordion

### Depth = search pages (no URL cap)
- Depth controls how many search result pages are fetched per key in the search engine (Yandex/Google).
- There is no explicit \"max URLs per key\" cap in MVP: the number of URLs depends on the engine output for the selected number of pages.
- Depth should have a sane default (MVP) and a hard upper bound to reduce captcha/rate-limit risk; tune later.

### Blacklist domains = root-domain rule
- The blacklist stores root domains (example: pulscen.ru).
- A blacklisted root domain blocks itself AND all its subdomains (spb.pulscen.ru, msk.pulscen.ru, etc).
- Filtering must be server-side: blacklisted domains/URLs must not appear in moderator parsing results at all.

### \"Accordion\" UI grouping (domain -> urls)
- Moderator UI shows parsing results grouped by domain (accordion): one domain row, expandable list of URLs.
- Grouping happens after blacklist filtering.
- Domain in results may include subdomains; blacklist matching must normalize URL hostname to root-domain.

### Suggested pipeline (where logic lives)
- parser_service: queries search engines up to Depth pages and returns raw URLs per key.
- backend: normalizes domains, applies root-domain blacklist filtering, groups results into accordion structure, and returns it via API.

## Moderator LK decisions (parsing + blacklist + resume)

- Priority: Moderator processes incoming client requests first; in free time, uses parsing results to gradually fill the suppliers base.
- Parsing start: Manual action in moderator LK (button like "Get URLs"). No auto-start for MVP.
- Parsing results: Moderator reviews URL groups and either creates supplier cards or adds domains to the global blacklist.

### Global domain blacklist (root-domain)
- Blacklist key is a hostname/root-domain only (e.g. cvetmetall.ru), without scheme (https://) and without trailing slash (/).
- Blacklist is global (shared across all requests and moderators).
- Blacklisted domains (including subdomains) MUST NOT appear in parsing-results responses (server-side filtering).
- Blacklist UI: accordion ("РіР°СЂРјРѕС€РєР°") where each domain expands into a list of captured URLs with created date and optional comment; sorting by date and alphabet is needed.

### Resume behavior (per key)
- If parsing partially fails, already collected results are preserved.
- Resume is per keyId: next start-parsing should parse only failed keys and continue from the page where the key failed (successful keys are not re-parsed).
- Comment on blacklist add is optional.

## Moderator LK scenario (draft) вЂ” 2025-12-16 17:56 MSK

### Goal

Moderator needs a working desk to run parsing, review domains/URLs, decide actions (4 statuses), and gradually build the supplier base; later user LK will send requests into the same pipeline.



### Manual moderator parsing (temporary request)

- Moderator enters a clean key (without the word "РєСѓРїРёС‚СЊ") and selects depth (default 10, max 50) and source (google/yandex/both).

- Backend uses "РєСѓРїРёС‚СЊ " as a hidden search prefix only when querying search engines; it must not be stored or displayed as part of the business key.

- Each manual run is stored in history (list + details) so moderator can return to previous runs.



### Results UI (accordion)

- Results are grouped by domain; domain row expands into a list of URLs.

- For each URL/domain, UI shows which keys brought this URL/domain (key-to-url mapping).



### Domain moderation decisions (4 statuses)

The moderation unit is the domain (root-domain aware). Each domain can be moved between statuses later.

- Green: Create Supplier card (required: INN, company name, email; URL is auto-filled from parsed domain/URL).

- Purple: Create Reseller/Trading Organization card (same required fields; marked as reseller for users).

- Black: Add to global domain blacklist (root-domain; blocks subdomains); optional comment.

- Yellow: Pending decision (separate list); domain stays visible until decision is made.

Once a decision is finalized (green/purple/black), the domain disappears from parsing results everywhere.



### Logging / analytics (domain hits)

Even if a domain is already decided/blacklisted, the system logs every occurrence: key -> url -> domain, so moderator can see which keys keep producing that domain.


## Moderator LK scenario (approved)  2025-12-16 18:01 MSK

### Goal

Moderator runs parsing from LK, reviews domains/URLs, applies one of 4 domain decisions, and grows supplier base. User LK will later feed requests into the same pipeline.



### Manual moderator parsing (temporary request with history)

- Moderator enters a clean key (without "РєСѓРїРёС‚СЊ"), selects depth (default 10, max 50) and source (google/yandex/both).

- Backend prepends hidden search prefix "РєСѓРїРёС‚СЊ " only when querying search engines; it must not be stored or shown as part of the business key.

- Each manual run is stored in history (list + details).



### Results UI (accordion)

- Results are grouped by domain; domain expands into URLs.

- For each URL/domain, show which keys produced it (key -> url -> domain mapping).



### Domain decisions (4 statuses)

- Green: Create Supplier card (required: INN, company name, primary email; URL auto-filled; extra emails allowed).

- Purple: Create Reseller/Trading Organization card (same required fields; flagged as reseller for users).

- Black: Add to global domain blacklist (root-domain; blocks subdomains); optional comment.

- Yellow: Pending decision queue; domain stays visible until decided.

After decision (green/purple/black), domain disappears from parsing results everywhere.



### Logging (domain hits)

Even for decided/blacklisted domains, log every occurrence: key -> url -> domain, so moderator can see which keys keep producing the domain.


## Local backend preflight (Windows)

Copy/paste checklist for endpoint work.

### Runtime URLs (no guessing)
- Verify backend is alive:
  - Invoke-RestMethod "http://127.0.0.1:8000/openapi.json" | Out-Null
  - Invoke-RestMethod "http://127.0.0.1:8000/health" | ConvertTo-Json -Depth 5
Expected: openapi.json returns 200; health returns {"status":"ok"}.

### Load DATABASEURL into current PowerShell
This repo keeps DB env in backend.env (local-only, do not commit).
- Load env (KEY=VALUE, supports comments with '#'):
  Get-Content .\backend.env | ForEach-Object {
    $line = $_.Trim()
    if ($line -eq "" -or $line.StartsWith("#")) { return }
    $i = $line.IndexOf("=")
    if ($i -lt 1) { return }
    $k = $line.Substring(0, $i).Trim()
    $v = $line.Substring($i + 1).Trim().Trim('"')
    if ($k) { Set-Item -Path ("Env:{0}" -f $k) -Value $v }
  }
- Verify env:
  python -c "import os; print(os.getenv('DATABASEURL'), os.getenv('DATABASE_URL'))"
Expected: DATABASEURL is not None when DB/migrations are needed.

### Alembic on Windows (works reliably)
Alembic config lives in backend\alembic.ini and scripts live in backend\alembic\.
To avoid ModuleNotFoundError for "app.*", set PYTHONPATH to repo\backend before running alembic.
- From repo root:
  Set-Item -Path Env:PYTHONPATH -Value (Join-Path (Get-Location).Path "backend")
  python -c "import app; print(app.__file__)"
Expected: prints D:\b2bplatform\backend\app\__init__.py (path may vary).

- Run alembic from backend folder (script_location = alembic):
  Set-Location .\backend
  alembic -c .\alembic.ini current
Expected: prints current revision, e.g. "9a051d01a91c (head)".

Common failure modes:
- "No 'script_location' key found": alembic was started without the correct ini.
- "Path doesn't exist: alembic": alembic.ini was used from the wrong working directory.
- "ModuleNotFoundError: No module named app": PYTHONPATH is not set to repo\backend.

### Moderator parsing results (accordion)

- Parsing results shown to the moderator are a list of unique domains (one domain appears once).
- Domains that match the global blacklist (root-domain rule, including all subdomains) MUST NOT appear in parsing-results at all.
- Expanding a domain (accordion) shows all collected URLs under this domain (different paths are shown as separate URLs).
- Full raw findings (including duplicates and key->url->domain hits) are preserved in logs for analytics/debugging.

