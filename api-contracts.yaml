openapi: 3.1.0
info:
  title: B2B Platform API
  version: 1.0.0
paths:
  /health:
    get:
      tags:
      - System
      summary: Health
      operationId: health_apiv1_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /user/requests:
    post:
      tags:
      - UserRequests
      summary: Create Request Manual
      operationId: create_request_manual_apiv1_user_requests_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRequestManualRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateRequestResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - UserRequests
      summary: List User Requests
      operationId: list_user_requests_apiv1_user_requests_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          minimum: 1
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/requests/{requestId}:
    get:
      tags:
      - UserRequests
      summary: Get User Request Detail
      operationId: get_user_request_detail_apiv1_user_requests__requestId__get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestDetailDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/requests/{requestId}/keys:
    put:
      tags:
      - UserRequests
      summary: Update User Request Keys
      operationId: update_user_request_keys_apiv1_user_requests__requestId__keys_put
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequestKeysRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestDetailDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/requests/{requestId}/submit:
    post:
      tags:
      - UserRequests
      summary: Submit User Request
      operationId: submit_user_request_apiv1_user_requests__requestId__submit_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitRequestResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/upload-and-create:
    post:
      tags:
      - UserRequests
      summary: Upload And Create
      operationId: upload_and_create_apiv1_user_upload_and_create_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Body_upload_and_create_apiv1_user_upload_and_create_post'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /userrequests/{requestId}/recipients:
    put:
      tags:
      - UserMessaging
      summary: Update Recipients
      operationId: update_recipients_apiv1_userrequests__requestId__recipients_put
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRecipientsRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecipientsResponse'
  /userrequests/{requestId}/send:
    post:
      tags:
      - UserMessaging
      summary: Send Request Messages
      operationId: send_request_messages_apiv1_userrequests__requestId__send_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /userrequests/{requestId}/send-new:
    post:
      tags:
      - UserMessaging
      summary: Send Request Messages New
      operationId: send_request_messages_new_apiv1_userrequests__requestId__send_new_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /userrequests/{requestId}/messages:
    get:
      tags:
      - UserMessaging
      summary: List Request Messages
      operationId: list_request_messages_apiv1_userrequests__requestId__messages_get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      - name: includedeleted
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Includedeleted
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /usermessages/{messageId}:
    delete:
      tags:
      - UserMessaging
      summary: Delete Message
      operationId: delete_message_apiv1_usermessages__messageId__delete
      parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: integer
          title: Messageid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/attachments:
    post:
      tags:
      - Attachments
      summary: Upload Attachment
      operationId: upload_attachment_apiv1_user_attachments_post
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Body_upload_attachment_apiv1_user_attachments_post'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - Attachments
      summary: List Attachments
      operationId: list_attachments_apiv1_user_attachments_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/attachments/{attachmentId}:
    get:
      tags:
      - Attachments
      summary: Get Attachment
      operationId: get_attachment_apiv1_user_attachments__attachmentId__get
      parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: integer
          title: Attachmentid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      tags:
      - Attachments
      summary: Delete Attachment
      operationId: delete_attachment_apiv1_user_attachments__attachmentId__delete
      parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: integer
          title: Attachmentid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/attachments/{attachmentId}/download:
    get:
      tags:
      - Attachments
      summary: Download Attachment
      operationId: download_attachment_apiv1_user_attachments__attachmentId__download_get
      parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: integer
          title: Attachmentid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /user/blacklist-inn:
    get:
      tags:
      - UserBlacklist
      summary: List User Blacklist Inn
      operationId: list_user_blacklist_inn_apiv1_user_blacklist_inn_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBlacklistInnListResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - UserBlacklist
      summary: Add User Blacklist Inn
      operationId: add_user_blacklist_inn_apiv1_user_blacklist_inn_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddUserBlacklistInnRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/blacklist-inn/{inn}:
    delete:
      tags:
      - UserBlacklist
      summary: Delete User Blacklist Inn
      operationId: delete_user_blacklist_inn_apiv1_user_blacklist_inn__inn__delete
      parameters:
      - name: inn
        in: path
        required: true
        schema:
          type: string
          title: Inn
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /user/blacklist-inn:
    get:
      tags:
      - UserBlacklist
      summary: List User Blacklist Inn
      operationId: list_user_blacklist_inn_apiv1_user_blacklist_inn_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBlacklistInnListResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - UserBlacklist
      summary: Add User Blacklist Inn
      operationId: add_user_blacklist_inn_apiv1_user_blacklist_inn_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddUserBlacklistInnRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/blacklist-inn/{inn}:
    delete:
      tags:
      - UserBlacklist
      summary: Delete User Blacklist Inn
      operationId: delete_user_blacklist_inn_apiv1_user_blacklist_inn__inn__delete
      parameters:
      - name: inn
        in: path
        required: true
        schema:
          type: string
          title: Inn
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /user/blacklist-inn:
    get:
      tags:
      - UserBlacklist
      summary: List User Blacklist Inn
      operationId: list_user_blacklist_inn_apiv1_user_blacklist_inn_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBlacklistInnListResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - UserBlacklist
      summary: Add User Blacklist Inn
      operationId: add_user_blacklist_inn_apiv1_user_blacklist_inn_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddUserBlacklistInnRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/blacklist-inn/{inn}:
    delete:
      tags:
      - UserBlacklist
      summary: Delete User Blacklist Inn
      operationId: delete_user_blacklist_inn_apiv1_user_blacklist_inn__inn__delete
      parameters:
      - name: inn
        in: path
        required: true
        schema:
          type: string
          title: Inn
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /auth/otp/request:
    post:
      tags:
      - Auth
      summary: Auth Otp Request
      operationId: auth_otp_request_apiv1_auth_otp_request_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthOtpRequestDTO'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /auth/otp/verify:
    post:
      tags:
      - Auth
      summary: Auth Otp Verify
      operationId: auth_otp_verify_apiv1_auth_otp_verify_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthOtpVerifyDTO'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /auth/me:
    get:
      tags:
      - Auth
      summary: Auth Me
      operationId: auth_me_apiv1_auth_me_get
      parameters:
      - name: authorization
        in: header
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Authorization
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /suppliers/search:
    get:
      tags:
      - Suppliers
      summary: Suppliers Search
      operationId: suppliers_search_apiv1_suppliers_search_get
      parameters:
      - name: q
        in: query
        required: true
        schema:
          type: string
          title: Q
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 20
          title: Limit
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierSearchResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/tasks:
    get:
      tags:
      - ModeratorTasks
      summary: List Moderator Tasks
      operationId: list_moderator_tasks_apiv1_moderator_tasks_get
      parameters:
      - name: status
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Status
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/tasks/{taskId}:
    get:
      tags:
      - ModeratorTasks
      summary: Get Moderator Task
      operationId: get_moderator_task_apiv1_moderator_tasks__taskId__get
      parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: integer
          title: Taskid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/requests/{requestId}/start-parsing:
    post:
      tags:
      - ModeratorTasks
      summary: Start Parsing
      description: |
        Initiates parsing for the given request. Returns a runId that can be used
        to poll parsing-status and parsing-results endpoints.
        
        Depth parameter controls the number of search result pages per key
        (Yandex/Google). Default is 10 pages if not specified.
      operationId: start_parsing_apiv1_moderator_requests__requestId__start_parsing_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartParsingRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StartParsingResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/requests/{requestId}/parsing-status:
    get:
      tags:
      - ModeratorTasks
      summary: Get Parsing Status
      description: |
        Returns the current status of a parsing run, including per-key breakdown.
        Use this endpoint to poll until overall status is 'succeeded' or 'failed'.
      operationId: get_parsing_status_apiv1_moderator_requests__requestId__parsing_status_get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParsingStatusResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/requests/{requestId}/parsing-results:
    get:
      tags:
      - ModeratorTasks
      summary: Get Parsing Results
      description: |
        Returns parsing results grouped by keyId. Results are returned as a complete
        list without pagination (no limit/offset).
        
        **Blacklist filtering rules:**
        - The domain blacklist stores root domains (e.g. `pulscen.ru`).
        - A blacklisted root domain blocks itself AND all its subdomains
          (e.g. blacklisting `pulscen.ru` also blocks `spb.pulscen.ru`, `msk.pulscen.ru`).
        - URLs/domains matching the blacklist are filtered out server-side and
          MUST NOT appear in this response. The moderator will never see blacklisted results.
      operationId: get_parsing_results_apiv1_moderator_requests__requestId__parsing_results_get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParsingResultsResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/suppliers:
    get:
      tags:
      - ModeratorSuppliers
      summary: List Moderator Suppliers
      operationId: list_moderator_suppliers_apiv1_moderator_suppliers_get
      parameters:
      - name: q
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Q
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - ModeratorSuppliers
      summary: Create Moderator Supplier
      operationId: create_moderator_supplier_apiv1_moderator_suppliers_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '409':
          description: Duplicate INN
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateInnErrorDTO'
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/suppliers/{supplierId}:
    get:
      tags:
      - ModeratorSuppliers
      summary: Get Moderator Supplier
      operationId: get_moderator_supplier_apiv1_moderator_suppliers__supplierId__get
      parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
          title: Supplierid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    put:
      tags:
      - ModeratorSuppliers
      summary: Update Moderator Supplier
      operationId: update_moderator_supplier_apiv1_moderator_suppliers__supplierId__put
      parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
          title: Supplierid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/blacklist/domains:
    post:
      tags:
      - Blacklist
      summary: Add Blacklist Domain
      operationId: add_blacklist_domain_apiv1_moderator_blacklist_domains_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - Blacklist
      summary: List Blacklist Domains
      operationId: list_blacklist_domains_apiv1_moderator_blacklist_domains_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/blacklist/domains/{domain}:
    delete:
      tags:
      - Blacklist
      summary: Delete Blacklist Domain
      operationId: delete_blacklist_domain_apiv1_moderator_blacklist_domains__domain__delete
      parameters:
      - name: domain
        in: path
        required: true
        schema:
          type: string
          title: Domain
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
components:
  schemas:
  SupplierSearchItemDTO:
    type: object
    additionalProperties: false
    required:
    - supplierid
    - name
    - inn
    - email
    - urls
    properties:
      supplierid:
        type: integer
        title: SupplierId
      name:
        type: string
        minLength: 1
        title: Name
      inn:
        type: string
        minLength: 10
        maxLength: 12
        title: Inn
      email:
        type: string
        format: email
        title: Email
      emails:
        anyOf:
        - type: array
          items:
            type: string
            format: email
        - type: 'null'
        title: Emails
      urls:
        type: array
        title: Urls
        minItems: 1
        items:
          type: string
      checko:
        anyOf:
        - type: object
          additionalProperties: true
        - type: 'null'
        title: Checko
    title: SupplierSearchItemDTO
    description: 'SSoT: api-contracts.yaml /components/schemas/SupplierSearchItemDTO'

  SupplierSearchResponseDTO:
    type: object
    additionalProperties: false
    required:
    - items
    - q
    - limit
    properties:
      items:
        type: array
        title: Items
        items:
          $ref: '#/components/schemas/SupplierSearchItemDTO'
      q:
        type: string
        title: Q
      limit:
        type: integer
        title: Limit
    title: SupplierSearchResponseDTO
    description: 'SSoT: api-contracts.yaml /components/schemas/SupplierSearchResponseDTO'
  DuplicateInnErrorDTO:
    type: object
    additionalProperties: false
    required:
      - error
      - inn
      - incomingurl
      - existingsupplier
    properties:
      error:
        type: string
        const: duplicate_inn
        title: Error
      inn:
        type: string
        title: Inn
      incomingurl:
        anyOf:
          - type: string
          - type: 'null'
        title: Incoming Url
      existingsupplier:
        type: object
        additionalProperties: false
        required:
          - supplierid
          - urls
        properties:
          supplierid:
            type: integer
            title: Supplierid
          name:
            anyOf:
              - type: string
              - type: 'null'
            title: Name
          urls:
            type: array
            title: Urls
            items:
              type: string
              title: Url
    AttachmentDTO:
      properties:
        id:
          type: integer
          title: Id
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
        originalfilename:
          type: string
          title: Originalfilename
        contenttype:
          anyOf:
          - type: string
          - type: 'null'
          title: Contenttype
        sizebytes:
          type: integer
          title: Sizebytes
        sha256:
          anyOf:
          - type: string
          - type: 'null'
          title: Sha256
        storagekey:
          anyOf:
          - type: string
          - type: 'null'
          title: Storagekey
        isdeleted:
          type: boolean
          title: Isdeleted
          default: false
        createdat:
          type: string
          title: Createdat
      additionalProperties: false
      type: object
      required:
      - id
      - originalfilename
      - sizebytes
      - createdat
      title: AttachmentDTO
      description: 'SSoT: api-contracts.yaml /components/schemas/Attachment

        ВАЖНО:

        - наружу отдаём lower-without-separators: originalfilename, contenttype, sizebytes,
        storagekey, isdeleted, createdat

        - внутри держим snake_case: original_filename, content_type, size_bytes, storage_key,
        is_deleted, created_at'
    AttachmentListResponseDTO:
      properties:
        items:
          items:
            $ref: '#/components/schemas/AttachmentDTO'
          type: array
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      additionalProperties: false
      type: object
      required:
      - items
      - limit
      - offset
      - total
      title: AttachmentListResponseDTO
      description: 'SSoT: api-contracts.yaml /components/schemas/AttachmentListResponse'
    AuthOtpRequestDTO:
      properties:
        email:
          type: string
          format: email
          title: Email
      type: object
      required:
      - email
      title: AuthOtpRequestDTO
    AuthOtpVerifyDTO:
      properties:
        email:
          type: string
          format: email
          title: Email
        code:
          type: string
          maxLength: 6
          minLength: 6
          title: Code
      type: object
      required:
      - email
      - code
      title: AuthOtpVerifyDTO
    Body_upload_and_create_apiv1_user_upload_and_create_post:
      properties:
        file:
          type: string
          format: binary
          title: File
      type: object
      required:
      - file
      title: Body_upload_and_create_apiv1_user_upload_and_create_post
    Body_upload_attachment_apiv1_user_attachments_post:
      properties:
        file:
          type: string
          format: binary
          title: File
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
      type: object
      required:
      - file
      title: Body_upload_attachment_apiv1_user_attachments_post
    CreateRequestManualRequestDTO:
      properties:
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
        keys:
          items:
            $ref: '#/components/schemas/RequestKeyInputDTO'
          type: array
          title: Keys
      type: object
      required:
      - keys
      title: CreateRequestManualRequestDTO
    CreateRequestResponseDTO:
      properties:
        success:
          type: boolean
          title: Success
        requestid:
          type: integer
          title: Requestid
        filename:
          anyOf:
          - type: string
          - type: 'null'
          title: Filename
        status:
          type: string
          title: Status
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      type: object
      required:
      - success
      - requestid
      - status
      title: CreateRequestResponseDTO
    GenericOkResponseDTO:
      properties:
        success:
          type: boolean
          title: Success
          default: true
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      additionalProperties: false
      type: object
      title: GenericOkResponseDTO
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError

  /user/blacklist-inn:
    get:
      tags:
      - UserBlacklist
      summary: List User Blacklist Inn
      operationId: list_user_blacklist_inn_apiv1_user_blacklist_inn_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBlacklistInnListResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - UserBlacklist
      summary: Add User Blacklist Inn
      operationId: add_user_blacklist_inn_apiv1_user_blacklist_inn_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddUserBlacklistInnRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/blacklist-inn/{inn}:
    delete:
      tags:
      - UserBlacklist
      summary: Delete User Blacklist Inn
      operationId: delete_user_blacklist_inn_apiv1_user_blacklist_inn__inn__delete
      parameters:
      - name: inn
        in: path
        required: true
        schema:
          type: string
          title: Inn
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    HealthResponse:
      properties:
        status:
          type: string
          title: Status
      type: object
      required:
      - status
      title: HealthResponse
    RequestDetailDTO:
      properties:
        id:
          type: integer
          title: Id
        filename:
          anyOf:
          - type: string
          - type: 'null'
          title: Filename
        status:
          type: string
          title: Status
        createdat:
          type: string
          title: Createdat
        keys:
          items:
            $ref: '#/components/schemas/RequestKeyDTO'
          type: array
          title: Keys
      type: object
      required:
      - id
      - status
      - createdat
      - keys
      title: RequestDetailDTO
    RequestKeyDTO:
      properties:
        id:
          type: integer
          title: Id
        pos:
          type: integer
          title: Pos
        rawtext:
          type: string
          title: Rawtext
        normalizedtext:
          type: string
          title: Normalizedtext
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        unit:
          anyOf:
          - type: string
          - type: 'null'
          title: Unit
        suppliers:
          items:
            additionalProperties: true
            type: object
          type: array
          title: Suppliers
      type: object
      required:
      - id
      - pos
      - rawtext
      - normalizedtext
      - suppliers
      title: RequestKeyDTO
    RequestKeyInputDTO:
      properties:
        pos:
          type: integer
          minimum: 1.0
          title: Pos
        text:
          type: string
          minLength: 1
          title: Text
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        unit:
          anyOf:
          - type: string
          - type: 'null'
          title: Unit
      type: object
      required:
      - pos
      - text
      title: RequestKeyInputDTO
    RequestListResponseDTO:
      properties:
        items:
          items:
            $ref: '#/components/schemas/RequestSummaryDTO'
          type: array
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      type: object
      required:
      - items
      - limit
      - offset
      - total
      title: RequestListResponseDTO
    RequestSummaryDTO:
      properties:
        id:
          type: integer
          title: Id
        filename:
          anyOf:
          - type: string
          - type: 'null'
          title: Filename
        status:
          type: string
          title: Status
        createdat:
          type: string
          title: Createdat
        keyscount:
          type: integer
          title: Keyscount
      type: object
      required:
      - id
      - status
      - createdat
      - keyscount
      title: RequestSummaryDTO
    SubmitRequestResponseDTO:
      properties:
        success:
          type: boolean
          title: Success
          default: true
        requestid:
          type: integer
          title: Requestid
        newstatus:
          type: string
          title: Newstatus
        matchedsuppliers:
          type: integer
          title: Matchedsuppliers
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      type: object
      required:
      - requestid
      - newstatus
      - matchedsuppliers
      title: SubmitRequestResponseDTO
    UpdateRequestKeysRequestDTO:
      properties:
        keys:
          items:
            $ref: '#/components/schemas/RequestKeyInputDTO'
          type: array
          title: Keys
      type: object
      required:
      - keys
      title: UpdateRequestKeysRequestDTO
    AddUserBlacklistInnRequest:
      type: object
      properties:
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
      required:
      - inn
      additionalProperties: false
    UserBlacklistInnItem:
      type: object
      properties:
        inn:
          type: string
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
        created_at:
          type: string
          title: Created At
      required:
      - inn
      - created_at
      additionalProperties: false
    UserBlacklistInnListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UserBlacklistInnItem'
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false
    AddUserBlacklistInnRequest:
      type: object
      properties:
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
      required:
      - inn
      additionalProperties: false
    UserBlacklistInnItem:
      type: object
      properties:
        inn:
          type: string
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
        created_at:
          type: string
          title: Created At
      required:
      - inn
      - created_at
      additionalProperties: false
    UserBlacklistInnListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UserBlacklistInnItem'
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false
    AddUserBlacklistInnRequest:
      type: object
      properties:
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
      required:
      - inn
      additionalProperties: false
    UserBlacklistInnItem:
      type: object
      properties:
        inn:
          type: string
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
        created_at:
          type: string
          title: Created At
      required:
      - inn
      - created_at
      additionalProperties: false
    UserBlacklistInnListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UserBlacklistInnItem'
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false
    AddUserBlacklistInnRequest:
      type: object
      properties:
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
      required:
      - inn
      additionalProperties: false
    UserBlacklistInnItem:
      type: object
      properties:
        inn:
          type: string
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: null
          title: Comment
        created_at:
          type: string
          title: Created At
      required:
      - inn
      - created_at
      additionalProperties: false
    UserBlacklistInnListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UserBlacklistInnItem'
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
    UpdateRecipientsRequest:
      type: object
      properties:
        recipients:
          type: array
          items:
            type: object
            properties:
              supplierid:
                type: integer
              selected:
                type: boolean
            required:
            - supplierid
            - selected
            additionalProperties: false
      required:
      - recipients
      additionalProperties: false
    RecipientsResponse:
      type: object
      properties:
        recipients:
          $ref: '#/components/schemas/UpdateRecipientsRequest/properties/recipients'
      required:
      - recipients
      additionalProperties: false
    StartParsingRequestDTO:
      type: object
      description: |
        Request body for starting a parsing run.
        SSoT: api-contracts.yaml /components/schemas/StartParsingRequestDTO
      properties:
        depth:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
          title: Depth
          description: |
            Number of search result pages per key for parser_service (Yandex/Google).
            This is the number of pages to crawl, not the number of URLs.
            Default is 10 if not specified.
      required: []
      additionalProperties: false
    StartParsingResponseDTO:
      type: object
      description: |
        Response returned when parsing is started.
        SSoT: api-contracts.yaml /components/schemas/StartParsingResponseDTO
      properties:
        requestId:
          type: integer
          title: RequestId
        runId:
          type: string
          title: RunId
          description: Unique identifier for this parsing run. Use to poll status/results.
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
      required:
      - requestId
      - runId
      - status
      additionalProperties: false
    ParsingRunStatus:
      type: string
      enum:
      - queued
      - running
      - succeeded
      - failed
      title: ParsingRunStatus
      description: |
        Status of a parsing run.
        SSoT: api-contracts.yaml /components/schemas/ParsingRunStatus
    ParsingKeyStatusDTO:
      type: object
      description: |
        Status of parsing for a single key.
        SSoT: api-contracts.yaml /components/schemas/ParsingKeyStatusDTO
      properties:
        keyId:
          type: integer
          title: KeyId
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
        itemsFound:
          type: integer
          minimum: 0
          title: ItemsFound
          description: Number of results found for this key (after blacklist filtering).
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
          description: Error message if status is 'failed', null otherwise.
      required:
      - keyId
      - status
      - itemsFound
      additionalProperties: false
    ParsingStatusResponseDTO:
      type: object
      description: |
        Overall parsing status with per-key breakdown.
        SSoT: api-contracts.yaml /components/schemas/ParsingStatusResponseDTO
      properties:
        requestId:
          type: integer
          title: RequestId
        runId:
          type: string
          title: RunId
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
          description: Overall status of the parsing run.
        keys:
          type: array
          title: Keys
          items:
            $ref: '#/components/schemas/ParsingKeyStatusDTO'
          description: Per-key parsing status breakdown.
      required:
      - requestId
      - runId
      - status
      - keys
      additionalProperties: false
    ParsingSource:
      type: string
      enum:
      - google
      - yandex
      title: ParsingSource
      description: |
        Search engine source where the result was found.
        SSoT: api-contracts.yaml /components/schemas/ParsingSource
    ParsingDomainGroupDTO:
      type: object
      description: |
        Parsing results grouped by domain (for moderator UI accordion).
        Each group represents a single domain and contains all URLs found for that domain.
        Blacklist filtering applies: if the root-domain is blacklisted, the entire group MUST NOT appear.
      properties:
        domain:
          type: string
          title: Domain
          description: Hostname (may include subdomain), e.g. spb.pulscen.ru.
        urls:
          type: array
          title: Urls
          minItems: 1
          items:
            type: string
            format: uri
        source:
          anyOf:
          - $ref: '#/components/schemas/ParsingSource'
          - type: 'null'
          title: Source
          description: Optional aggregated source; null if unknown or mixed.
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Optional representative title; may be null.
      required:
      - domain
      - urls
      additionalProperties: false

    ParsingResultItemDTO:
      type: object
      description: |
        Single parsing result item.
        SSoT: api-contracts.yaml /components/schemas/ParsingResultItemDTO
        
        Note on 'domain' field: This is the hostname extracted from the URL and may
        include subdomains (e.g. 'spb.pulscen.ru'). Server-side filtering uses root
        domain matching against the blacklist - if root domain (e.g. 'pulscen.ru')
        is blacklisted, this item will NOT appear in the response.
      properties:
        url:
          type: string
          format: uri
          title: Url
          description: Full URL of the search result.
        domain:
          type: string
          title: Domain
          description: |
            Hostname from the URL (may include subdomain, e.g. 'spb.pulscen.ru').
            Filtered by root-domain blacklist on server side.
        source:
          $ref: '#/components/schemas/ParsingSource'
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Page title from search results, may be null.
      required:
      - url
      - domain
      - source
      additionalProperties: false
    ParsingResultsByKeyDTO:
      type: object
      description: |
        Parsing results for a single key.
        SSoT: api-contracts.yaml /components/schemas/ParsingResultsByKeyDTO
      properties:
        keyId:
          type: integer
          title: KeyId
        groups:
          type: array
          title: Groups
          items:
            $ref: '#/components/schemas/ParsingDomainGroupDTO'
          description: Domain groups for this key (blacklist-filtered). Each group contains all URLs for that domain.
      required:
      - keyId
      - groups
      additionalProperties: false
    ParsingResultsResponseDTO:
      type: object
      description: |
        Complete parsing results grouped by keyId.
        SSoT: api-contracts.yaml /components/schemas/ParsingResultsResponseDTO
        
        All results are returned at once (no pagination). URLs matching the domain
        blacklist (root domain + subdomains) are excluded and will not appear here.
      properties:
        requestId:
          type: integer
          title: RequestId
        runId:
          type: string
          title: RunId
        results:
          type: array
          title: Results
          items:
            $ref: '#/components/schemas/ParsingResultsByKeyDTO'
          description: Results grouped by keyId.
      required:
      - requestId
      - runId
      - results
      additionalProperties: false
