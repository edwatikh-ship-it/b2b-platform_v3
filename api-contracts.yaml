openapi: 3.1.0
info:
  title: B2B Platform API
  version: 1.0.0
paths:
  /health:
    get:
      tags:
      - System
      summary: Health
      operationId: health_apiv1_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /user/requests:
    post:
      tags:
      - UserRequests
      summary: Create Request Manual
      operationId: create_request_manual_apiv1_user_requests_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRequestManualRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateRequestResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - UserRequests
      summary: List User Requests
      operationId: list_user_requests_apiv1_user_requests_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          minimum: 1
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/requests/{requestId}:
    get:
      tags:
      - UserRequests
      summary: Get User Request Detail
      operationId: get_user_request_detail_apiv1_user_requests__requestId__get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestDetailDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/requests/{requestId}/keys:
    put:
      tags:
      - UserRequests
      summary: Update User Request Keys
      operationId: update_user_request_keys_apiv1_user_requests__requestId__keys_put
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequestKeysRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestDetailDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/requests/{requestId}/submit:
    post:
      tags:
      - UserRequests
      summary: Submit User Request
      operationId: submit_user_request_apiv1_user_requests__requestId__submit_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitRequestResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/upload-and-create:
    post:
      tags:
      - UserRequests
      summary: Upload And Create
      operationId: upload_and_create_apiv1_user_upload_and_create_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Body_upload_and_create_apiv1_user_upload_and_create_post'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /userrequests/{requestId}/recipients:
    put:
      tags:
      - UserMessaging
      summary: Update Recipients
      operationId: update_recipients_apiv1_userrequests__requestId__recipients_put
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRecipientsRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecipientsResponse'
  /userrequests/{requestId}/send:
    post:
      tags:
      - UserMessaging
      summary: Send Request Messages
      operationId: send_request_messages_apiv1_userrequests__requestId__send_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /userrequests/{requestId}/send-new:
    post:
      tags:
      - UserMessaging
      summary: Send Request Messages New
      operationId: send_request_messages_new_apiv1_userrequests__requestId__send_new_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              title: Payload
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /userrequests/{requestId}/messages:
    get:
      tags:
      - UserMessaging
      summary: List Request Messages
      operationId: list_request_messages_apiv1_userrequests__requestId__messages_get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      - name: includedeleted
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Includedeleted
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /usermessages/{messageId}:
    delete:
      tags:
      - UserMessaging
      summary: Delete Message
      operationId: delete_message_apiv1_usermessages__messageId__delete
      parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: integer
          title: Messageid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/attachments:
    post:
      tags:
      - Attachments
      summary: Upload Attachment
      operationId: upload_attachment_apiv1_user_attachments_post
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Body_upload_attachment_apiv1_user_attachments_post'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - Attachments
      summary: List Attachments
      operationId: list_attachments_apiv1_user_attachments_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/attachments/{attachmentId}:
    get:
      tags:
      - Attachments
      summary: Get Attachment
      operationId: get_attachment_apiv1_user_attachments__attachmentId__get
      parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: integer
          title: Attachmentid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      tags:
      - Attachments
      summary: Delete Attachment
      operationId: delete_attachment_apiv1_user_attachments__attachmentId__delete
      parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: integer
          title: Attachmentid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/attachments/{attachmentId}/download:
    get:
      tags:
      - Attachments
      summary: Download Attachment
      operationId: download_attachment_apiv1_user_attachments__attachmentId__download_get
      parameters:
      - name: attachmentId
        in: path
        required: true
        schema:
          type: integer
          title: Attachmentid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /user/blacklist-inn:
    get:
      tags:
      - UserBlacklist
      summary: List User Blacklist Inn
      operationId: list_user_blacklist_inn_apiv1_user_blacklist_inn_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBlacklistInnListResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - UserBlacklist
      summary: Add User Blacklist Inn
      operationId: add_user_blacklist_inn_apiv1_user_blacklist_inn_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddUserBlacklistInnRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /user/blacklist-inn/{inn}:
    delete:
      tags:
      - UserBlacklist
      summary: Delete User Blacklist Inn
      operationId: delete_user_blacklist_inn_apiv1_user_blacklist_inn__inn__delete
      parameters:
      - name: inn
        in: path
        required: true
        schema:
          type: string
          title: Inn
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /auth/otp/request:
    post:
      tags:
      - Auth
      summary: Auth Otp Request
      operationId: auth_otp_request_apiv1_auth_otp_request_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthOtpRequestDTO'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /auth/otp/verify:
    post:
      tags:
      - Auth
      summary: Auth Otp Verify
      operationId: auth_otp_verify_apiv1_auth_otp_verify_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthOtpVerifyDTO'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /auth/me:
    get:
      tags:
      - Auth
      summary: Auth Me
      operationId: auth_me_apiv1_auth_me_get
      parameters:
      - name: authorization
        in: header
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Authorization
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /suppliers/search:
    get:
      tags:
      - Suppliers
      summary: Suppliers Search
      operationId: suppliers_search_apiv1_suppliers_search_get
      parameters:
      - name: q
        in: query
        required: true
        schema:
          type: string
          title: Q
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 20
          title: Limit
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierSearchResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/tasks:
    get:
      tags:
      - ModeratorTasks
      summary: List Moderator Tasks
      operationId: list_moderator_tasks_apiv1_moderator_tasks_get
      parameters:
      - name: status
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Status
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/tasks/{taskId}:
    get:
      tags:
      - ModeratorTasks
      summary: Get Moderator Task
      operationId: get_moderator_task_apiv1_moderator_tasks__taskId__get
      parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: integer
          title: Taskid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/requests/{requestId}/start-parsing:
    post:
      tags:
      - ModeratorTasks
      summary: Start Parsing
      description: |
        Initiates parsing for the given request. Returns a runId that can be used
        to poll parsing-status and parsing-results endpoints.
        
        Depth parameter controls the number of search result pages per key
        (Yandex/Google). Default is 10 pages if not specified.
      operationId: start_parsing_apiv1_moderator_requests__requestId__start_parsing_post
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartParsingRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StartParsingResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/requests/{requestId}/parsing-status:
    get:
      tags:
      - ModeratorTasks
      summary: Get Parsing Status
      description: |
        Returns the current status of a parsing run, including per-key breakdown.
        Use this endpoint to poll until overall status is 'succeeded' or 'failed'.
      operationId: get_parsing_status_apiv1_moderator_requests__requestId__parsing_status_get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParsingStatusResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/requests/{requestId}/parsing-results:
    get:
      tags:
      - ModeratorTasks
      summary: Get Parsing Results
      description: |
        Returns parsing results grouped by keyId. Results are returned as a complete
        list without pagination (no limit/offset).
        
        **Blacklist filtering rules:**
        - The domain blacklist stores root domains (e.g. `pulscen.ru`).
        - A blacklisted root domain blocks itself AND all its subdomains
          (e.g. blacklisting `pulscen.ru` also blocks `spb.pulscen.ru`, `msk.pulscen.ru`).
        - URLs/domains matching the blacklist are filtered out server-side and
          MUST NOT appear in this response. The moderator will never see blacklisted results.
      operationId: get_parsing_results_apiv1_moderator_requests__requestId__parsing_results_get
      parameters:
      - name: requestId
        in: path
        required: true
        schema:
          type: integer
          title: Requestid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParsingResultsResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/suppliers:
    get:
      tags:
      - ModeratorSuppliers
      summary: List Moderator Suppliers
      operationId: list_moderator_suppliers_apiv1_moderator_suppliers_get
      parameters:
      - name: q
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Q
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      tags:
      - ModeratorSuppliers
      summary: Create Moderator Supplier
      operationId: create_moderator_supplier_apiv1_moderator_suppliers_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSupplierCardRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierCardDTO'
        '409':
          description: Duplicate INN
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateInnErrorDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/suppliers/{supplierId}:
    get:
      tags:
      - ModeratorSuppliers
      summary: Get Moderator Supplier
      operationId: get_moderator_supplier_apiv1_moderator_suppliers__supplierId__get
      parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
          title: Supplierid
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierCardDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    put:
      tags:
      - ModeratorSuppliers
      summary: Update Moderator Supplier
      operationId: update_moderator_supplier_apiv1_moderator_suppliers__supplierId__put
      parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
          title: Supplierid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSupplierCardRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierCardDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/blacklist/domains:
    post:
      tags:
      - Blacklist
      summary: Add Blacklist Domain
      operationId: add_blacklist_domain_apiv1_moderator_blacklist_domains_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddModeratorBlacklistDomainRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModeratorBlacklistDomainDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - Blacklist
      summary: List Blacklist Domains
      operationId: list_blacklist_domains_apiv1_moderator_blacklist_domains_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          default: 200
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModeratorBlacklistDomainListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/blacklist/domains/{domain}:
    delete:
      tags:
      - Blacklist
      summary: Delete Blacklist Domain
      operationId: delete_blacklist_domain_apiv1_moderator_blacklist_domains__domain__delete
      parameters:
      - name: domain
        in: path
        required: true
        schema:
          type: string
          title: Domain
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericOkResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  # ============================================================================
  # MODERATOR PARSING RUNS (Временные заявки модератора)
  # История ручных запусков парсинга
  # ============================================================================
  /moderator/parsing-runs:
    post:
      tags:
      - ModeratorParsingRuns
      summary: Create Parsing Run
      description: |
        Создаёт новый ручной запуск парсинга по одному поисковому ключу.
        Позволяет модератору проверить результаты парсинга без привязки к заявке пользователя.
        
        **ВАЖНО:** Клиент передаёт чистый ключ (например, "труба стальная 100мм").
        Backend автоматически добавляет префикс "купить " при формировании поискового запроса.
        Клиент НЕ ДОЛЖЕН передавать "купить" в ключе.
        
        - key: чистый поисковый ключ без префикса "купить" (обязательный)
        - depth: глубина парсинга (количество страниц), default=10, max=50
        - source: источник парсинга (google/yandex/both), default=both
      operationId: create_parsing_run_apiv1_moderator_parsing_runs_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateModeratorParsingRunRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModeratorParsingRunDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - ModeratorParsingRuns
      summary: List Parsing Runs
      description: |
        Возвращает список всех ручных запусков парсинга модератора.
        Поддерживает пагинацию и фильтрацию по статусу.
      operationId: list_parsing_runs_apiv1_moderator_parsing_runs_get
      parameters:
      - name: requestId
        in: query
        required: false
        description: Фильтр по requestId (для истории запусков внутри конкретной заявки)
        schema:
          anyOf:
          - type: integer
          - type: 'null'
          title: RequestId
      - name: status
        in: query
        required: false
        description: Фильтр по статусу запуска
        schema:
          anyOf:
          - $ref: '#/components/schemas/ParsingRunStatus'
          - type: 'null'
          title: Status
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          minimum: 1
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModeratorParsingRunListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/parsing-runs/{runId}:
    get:
      tags:
      - ModeratorParsingRuns
      summary: Get Parsing Run Detail
      description: |
        Возвращает детали запуска парсинга, включая статус и результаты.
        Результаты группируются по доменам (аккордеон для UI).
      operationId: get_parsing_run_detail_apiv1_moderator_parsing_runs__runId__get
      parameters:
      - name: runId
        in: path
        required: true
        schema:
          type: string
          title: RunId
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModeratorParsingRunDetailDTO'
        '404':
          description: Run not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  # ============================================================================
  # PENDING DOMAINS QUEUE (Очередь доменов ждут решения)
  # Домены со статусом pending с аккордеоном URL-ов
  # ============================================================================
  /moderator/pending-domains:
    get:
      tags:
      - ModeratorPendingDomains
      summary: List Pending Domains
      description: |
        Возвращает список доменов со статусом pending, ожидающих решения модератора.
        
        Каждый домен содержит:
        - Список URL-ов (для аккордеона в UI)
        - Привязку URL → ключи (какие поисковые ключи привели к этому URL)
        - Общее количество попаданий (hits)
        
        Сортировка по умолчанию: по количеству попаданий (desc).
      operationId: list_pending_domains_apiv1_moderator_pending_domains_get
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          minimum: 1
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      - name: sortby
        in: query
        required: false
        description: Поле для сортировки
        schema:
          type: string
          enum:
          - hits
          - createdat
          - domain
          default: hits
          title: SortBy
      - name: sortorder
        in: query
        required: false
        schema:
          type: string
          enum:
          - asc
          - desc
          default: desc
          title: SortOrder
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PendingDomainListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/pending-domains/{domain}:
    get:
      tags:
      - ModeratorPendingDomains
      summary: Get Pending Domain Detail
      description: |
        Возвращает детальную информацию о pending-домене:
        - Все URL-ы домена
        - Для каждого URL — список ключей, которые к нему привели
        - История попаданий
      operationId: get_pending_domain_detail_apiv1_moderator_pending_domains__domain__get
      parameters:
      - name: domain
        in: path
        required: true
        description: |
          Root-домен в нормализованном виде (без www, без схемы, без путей).
          Примеры: 'example.com', 'pulscen.ru'.
          НЕ допускается: 'www.example.com', 'https://example.com', 'example.com/path'.
        schema:
          type: string
          pattern: '^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$'
          title: Domain
          example: 'pulscen.ru'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PendingDomainDetailDTO'
        '404':
          description: Domain not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  # ============================================================================
  # DOMAIN DECISION (Принять решение по домену)
  # ============================================================================
  /moderator/domains/{domain}/decision:
    post:
      tags:
      - ModeratorDomainDecision
      summary: Make Domain Decision
      description: |
        Принять решение по домену. Возможные статусы:
        - supplier: домен принадлежит поставщику → создаётся/обновляется карточка поставщика
        - reseller: домен принадлежит реселлеру → создаётся/обновляется карточка реселлера
        - blacklist: домен добавляется в чёрный список
        - pending: вернуть в очередь ожидания (сброс решения)
        
        Для supplier/reseller обязательны поля: inn, name, email.
        URL подтягивается автоматически из домена.
        
        Решение можно изменить в будущем повторным вызовом этого endpoint.
        
        **Нормализация домена:** используется root-домен без www.
      operationId: make_domain_decision_apiv1_moderator_domains__domain__decision_post
      parameters:
      - name: domain
        in: path
        required: true
        description: |
          Root-домен в нормализованном виде (без www, без схемы, без путей).
          Примеры: 'example.com', 'pulscen.ru'.
          НЕ допускается: 'www.example.com', 'https://example.com'.
        schema:
          type: string
          pattern: '^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$'
          title: Domain
          example: 'pulscen.ru'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainDecisionRequestDTO'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DomainDecisionResponseDTO'
        '404':
          description: Domain not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - ModeratorDomainDecision
      summary: Get Domain Decision
      description: |
        Получить текущее решение по домену (если есть).
        Возвращает статус, дату решения и связанную карточку (если есть).
      operationId: get_domain_decision_apiv1_moderator_domains__domain__decision_get
      parameters:
      - name: domain
        in: path
        required: true
        description: |
          Root-домен в нормализованном виде (без www, без схемы, без путей).
          Примеры: 'example.com', 'pulscen.ru'.
        schema:
          type: string
          pattern: '^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$'
          title: Domain
          example: 'pulscen.ru'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DomainDecisionResponseDTO'
        '404':
          description: Domain not found or no decision made
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  # ============================================================================
  # DOMAIN/URL HITS LOG (Лог попаданий)
  # ============================================================================
  /moderator/domains/{domain}/hits:
    get:
      tags:
      - ModeratorHitsLog
      summary: Get Domain Hits
      description: |
        Возвращает лог попаданий для домена — список всех ключей, 
        которые когда-либо приводили к этому домену.
        
        Лог сохраняется даже если домен забанен или по нему принято решение.
        Это позволяет анализировать, какие поисковые запросы приводят к домену.
      operationId: get_domain_hits_apiv1_moderator_domains__domain__hits_get
      parameters:
      - name: domain
        in: path
        required: true
        description: |
          Root-домен в нормализованном виде (без www, без схемы, без путей).
          Примеры: 'example.com', 'pulscen.ru'.
        schema:
          type: string
          pattern: '^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$'
          title: Domain
          example: 'pulscen.ru'
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 500
          minimum: 1
          default: 100
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DomainHitsResponseDTO'
        '404':
          description: Domain not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /moderator/urls/hits:
    get:
      tags:
      - ModeratorHitsLog
      summary: Get URL Hits
      description: |
        Возвращает лог попаданий для конкретного URL — список всех ключей,
        которые когда-либо приводили к этому URL.
        
        Полезно для детального анализа отдельных страниц.
      operationId: get_url_hits_apiv1_moderator_urls_hits_get
      parameters:
      - name: url
        in: query
        required: true
        schema:
          type: string
          format: uri
          title: Url
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 500
          minimum: 1
          default: 100
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlHitsResponseDTO'
        '404':
          description: URL not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  # ============================================================================
  # RESOLVED DOMAINS (История решений)
  # ============================================================================
  /moderator/resolved-domains:
    get:
      tags:
      - ModeratorResolvedDomains
      summary: List Resolved Domains
      description: |
        Возвращает список доменов, по которым было принято решение
        (supplier, reseller, blacklist). Не включает pending.
        
        Поддерживает фильтрацию по статусу решения.
      operationId: list_resolved_domains_apiv1_moderator_resolved_domains_get
      parameters:
      - name: status
        in: query
        required: false
        description: Фильтр по статусу решения
        schema:
          anyOf:
          - $ref: '#/components/schemas/DomainDecisionStatus'
          - type: 'null'
          title: Status
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          minimum: 1
          default: 50
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResolvedDomainListResponseDTO'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

components:
  schemas:
    # ==========================================================================
    # EXISTING SCHEMAS (сохранены без изменений)
    # ==========================================================================
    SupplierSearchItemDTO:
      type: object
      additionalProperties: false
      required:
      - supplierid
      - name
      - inn
      - email
      - urls
      properties:
        supplierid:
          type: integer
          title: SupplierId
        name:
          type: string
          minLength: 1
          title: Name
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        email:
          type: string
          format: email
          title: Email
        emails:
          anyOf:
          - type: array
            items:
              type: string
              format: email
          - type: 'null'
          title: Emails
        urls:
          type: array
          title: Urls
          minItems: 1
          items:
            type: string
        checko:
          anyOf:
          - type: object
            additionalProperties: true
          - type: 'null'
          title: Checko
      title: SupplierSearchItemDTO
      description: 'SSoT: api-contracts.yaml /components/schemas/SupplierSearchItemDTO'

    SupplierSearchResponseDTO:
      type: object
      additionalProperties: false
      required:
      - items
      - q
      - limit
      properties:
        items:
          type: array
          title: Items
          items:
            $ref: '#/components/schemas/SupplierSearchItemDTO'
        q:
          type: string
          title: Q
        limit:
          type: integer
          title: Limit
      title: SupplierSearchResponseDTO
      description: 'SSoT: api-contracts.yaml /components/schemas/SupplierSearchResponseDTO'

    DuplicateInnErrorDTO:
      type: object
      additionalProperties: false
      required:
        - error
        - inn
        - incomingurl
        - existingsupplier
      properties:
        error:
          type: string
          const: duplicate_inn
          title: Error
        inn:
          type: string
          title: Inn
        incomingurl:
          anyOf:
            - type: string
            - type: 'null'
          title: Incoming Url
        existingsupplier:
          type: object
          additionalProperties: false
          required:
            - supplierid
            - urls
          properties:
            supplierid:
              type: integer
              title: Supplierid
            name:
              anyOf:
                - type: string
                - type: 'null'
              title: Name
            urls:
              type: array
              title: Urls
              items:
                type: string
                title: Url

    AttachmentDTO:
      properties:
        id:
          type: integer
          title: Id
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
        originalfilename:
          type: string
          title: Originalfilename
        contenttype:
          anyOf:
          - type: string
          - type: 'null'
          title: Contenttype
        sizebytes:
          type: integer
          title: Sizebytes
        sha256:
          anyOf:
          - type: string
          - type: 'null'
          title: Sha256
        storagekey:
          anyOf:
          - type: string
          - type: 'null'
          title: Storagekey
        isdeleted:
          type: boolean
          title: Isdeleted
          default: false
        createdat:
          type: string
          title: Createdat
      additionalProperties: false
      type: object
      required:
      - id
      - originalfilename
      - sizebytes
      - createdat
      title: AttachmentDTO
      description: 'SSoT: api-contracts.yaml /components/schemas/AttachmentDTO'

    AttachmentListResponseDTO:
      properties:
        items:
          items:
            $ref: '#/components/schemas/AttachmentDTO'
          type: array
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      additionalProperties: false
      type: object
      required:
      - items
      - limit
      - offset
      - total
      title: AttachmentListResponseDTO
      description: 'SSoT: api-contracts.yaml /components/schemas/AttachmentListResponseDTO'

    AuthOtpRequestDTO:
      properties:
        email:
          type: string
          format: email
          title: Email
      type: object
      required:
      - email
      title: AuthOtpRequestDTO

    AuthOtpVerifyDTO:
      properties:
        email:
          type: string
          format: email
          title: Email
        code:
          type: string
          maxLength: 6
          minLength: 6
          title: Code
      type: object
      required:
      - email
      - code
      title: AuthOtpVerifyDTO

    Body_upload_and_create_apiv1_user_upload_and_create_post:
      properties:
        file:
          type: string
          format: binary
          title: File
      type: object
      required:
      - file
      title: Body_upload_and_create_apiv1_user_upload_and_create_post

    Body_upload_attachment_apiv1_user_attachments_post:
      properties:
        file:
          type: string
          format: binary
          title: File
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
      type: object
      required:
      - file
      title: Body_upload_attachment_apiv1_user_attachments_post

    CreateRequestManualRequestDTO:
      properties:
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
        keys:
          items:
            $ref: '#/components/schemas/RequestKeyInputDTO'
          type: array
          title: Keys
      type: object
      required:
      - keys
      title: CreateRequestManualRequestDTO

    CreateRequestResponseDTO:
      properties:
        success:
          type: boolean
          title: Success
        requestid:
          type: integer
          title: Requestid
        filename:
          anyOf:
          - type: string
          - type: 'null'
          title: Filename
        status:
          type: string
          title: Status
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      type: object
      required:
      - success
      - requestid
      - status
      title: CreateRequestResponseDTO

    GenericOkResponseDTO:
      properties:
        success:
          type: boolean
          title: Success
          default: true
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      additionalProperties: false
      type: object
      title: GenericOkResponseDTO

    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError

    HealthResponse:
      properties:
        status:
          type: string
          title: Status
      type: object
      required:
      - status
      title: HealthResponse

    RequestDetailDTO:
      properties:
        id:
          type: integer
          title: Id
        filename:
          anyOf:
          - type: string
          - type: 'null'
          title: Filename
        status:
          type: string
          title: Status
        createdat:
          type: string
          title: Createdat
        keys:
          items:
            $ref: '#/components/schemas/RequestKeyDTO'
          type: array
          title: Keys
      type: object
      required:
      - id
      - status
      - createdat
      - keys
      title: RequestDetailDTO

    RequestKeyDTO:
      properties:
        id:
          type: integer
          title: Id
        pos:
          type: integer
          title: Pos
        rawtext:
          type: string
          title: Rawtext
        normalizedtext:
          type: string
          title: Normalizedtext
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        unit:
          anyOf:
          - type: string
          - type: 'null'
          title: Unit
        suppliers:
          items:
            additionalProperties: true
            type: object
          type: array
          title: Suppliers
      type: object
      required:
      - id
      - pos
      - rawtext
      - normalizedtext
      - suppliers
      title: RequestKeyDTO

    RequestKeyInputDTO:
      properties:
        pos:
          type: integer
          minimum: 1
          title: Pos
        text:
          type: string
          minLength: 1
          title: Text
        qty:
          anyOf:
          - type: number
          - type: 'null'
          title: Qty
        unit:
          anyOf:
          - type: string
          - type: 'null'
          title: Unit
      type: object
      required:
      - pos
      - text
      title: RequestKeyInputDTO

    RequestListResponseDTO:
      properties:
        items:
          items:
            $ref: '#/components/schemas/RequestSummaryDTO'
          type: array
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      type: object
      required:
      - items
      - limit
      - offset
      - total
      title: RequestListResponseDTO

    RequestSummaryDTO:
      properties:
        id:
          type: integer
          title: Id
        filename:
          anyOf:
          - type: string
          - type: 'null'
          title: Filename
        status:
          type: string
          title: Status
        createdat:
          type: string
          title: Createdat
        keyscount:
          type: integer
          title: Keyscount
      type: object
      required:
      - id
      - status
      - createdat
      - keyscount
      title: RequestSummaryDTO

    SubmitRequestResponseDTO:
      properties:
        success:
          type: boolean
          title: Success
          default: true
        requestid:
          type: integer
          title: Requestid
        newstatus:
          type: string
          title: Newstatus
        matchedsuppliers:
          type: integer
          title: Matchedsuppliers
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      type: object
      required:
      - requestid
      - newstatus
      - matchedsuppliers
      title: SubmitRequestResponseDTO

    UpdateRequestKeysRequestDTO:
      properties:
        keys:
          items:
            $ref: '#/components/schemas/RequestKeyInputDTO'
          type: array
          title: Keys
      type: object
      required:
      - keys
      title: UpdateRequestKeysRequestDTO

    AddUserBlacklistInnRequest:
      type: object
      properties:
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
      required:
      - inn
      additionalProperties: false

    UserBlacklistInnItem:
      type: object
      properties:
        inn:
          type: string
          title: Inn
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
        createdat:
          type: string
          title: CreatedAt
      required:
      - inn
      - createdat
      additionalProperties: false

    UserBlacklistInnListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/UserBlacklistInnItem'
          title: Items
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false

    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError

    UpdateRecipientsRequest:
      type: object
      properties:
        recipients:
          type: array
          items:
            type: object
            properties:
              supplierid:
                type: integer
              selected:
                type: boolean
            required:
            - supplierid
            - selected
            additionalProperties: false
      required:
      - recipients
      additionalProperties: false

    RecipientsResponse:
      type: object
      properties:
        recipients:
          $ref: '#/components/schemas/UpdateRecipientsRequest/properties/recipients'
      required:
      - recipients
      additionalProperties: false

    StartParsingRequestDTO:
      type: object
      description: |
        Request body for starting a parsing run.
        SSoT: api-contracts.yaml /components/schemas/StartParsingRequestDTO
      properties:
        depth:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
          title: Depth
          description: |
            Number of search result pages per key for parser_service (Yandex/Google).
            This is the number of pages to crawl, not the number of URLs.
            Default is 10 if not specified.
        resume:
          type: boolean
          default: true
          title: Resume
          description: |
            Continue parsing from the point of failure using stored progress keys.
            If true, parser will resume from last processed page for each key.
            If false, parsing will start from the beginning.
            Default is true.
      required: []
      additionalProperties: false

    StartParsingResponseDTO:
      type: object
      description: |
        Response returned when parsing is started.
        SSoT: api-contracts.yaml /components/schemas/StartParsingResponseDTO
      properties:
        requestId:
          type: integer
          title: RequestId
        runId:
          type: string
          title: RunId
          description: Unique identifier for this parsing run. Use to poll status/results.
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
      required:
      - requestId
      - runId
      - status
      additionalProperties: false

    ParsingRunStatus:
      type: string
      enum:
      - queued
      - running
      - succeeded
      - failed
      title: ParsingRunStatus
      description: |
        Status of a parsing run.
        SSoT: api-contracts.yaml /components/schemas/ParsingRunStatus

    ParsingKeyStatusDTO:
      type: object
      description: |
        Status of parsing for a single key.
        SSoT: api-contracts.yaml /components/schemas/ParsingKeyStatusDTO
      properties:
        keyId:
          type: integer
          title: KeyId
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
        itemsFound:
          type: integer
          minimum: 0
          title: ItemsFound
          description: Number of results found for this key (after blacklist filtering).
        lastProcessedPage:
          type: integer
          minimum: 0
          title: LastProcessedPage
          description: |
            Last successfully processed search result page number (0 if parsing hasn't started).
            Used for resume functionality to continue from last successful page.
        failedAtPage:
          anyOf:
          - type: integer
            minimum: 1
          - type: 'null'
          title: FailedAtPage
          description: |
            Page number where parsing failed, if status is 'failed'. Null otherwise.
            Helps diagnose which page caused the failure.
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
          description: Error message if status is 'failed', null otherwise.
      required:
      - keyId
      - status
      - itemsFound
      - lastProcessedPage
      additionalProperties: false

    ParsingStatusResponseDTO:
      type: object
      description: |
        Overall parsing status with per-key breakdown.
        SSoT: api-contracts.yaml /components/schemas/ParsingStatusResponseDTO
      properties:
        requestId:
          type: integer
          title: RequestId
        runId:
          type: string
          title: RunId
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
          description: Overall status of the parsing run.
        keys:
          type: array
          title: Keys
          items:
            $ref: '#/components/schemas/ParsingKeyStatusDTO'
          description: Per-key parsing status breakdown.
      required:
      - requestId
      - runId
      - status
      - keys
      additionalProperties: false

    ParsingSource:
      type: string
      enum:
      - google
      - yandex
      title: ParsingSource
      description: |
        Search engine source where the result was found.
        SSoT: api-contracts.yaml /components/schemas/ParsingSource

    ParsingDomainGroupDTO:
      type: object
      description: |
        Parsing results grouped by domain (for moderator UI accordion).
        Each group represents a single domain and contains all URLs found for that domain.
        Blacklist filtering applies: if the root-domain is blacklisted, the entire group MUST NOT appear.
      properties:
        domain:
          type: string
          title: Domain
          description: Hostname (may include subdomain), e.g. spb.pulscen.ru.
        urls:
          type: array
          title: Urls
          minItems: 1
          items:
            type: string
            format: uri
        source:
          anyOf:
          - $ref: '#/components/schemas/ParsingSource'
          - type: 'null'
          title: Source
          description: Optional aggregated source; null if unknown or mixed.
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Optional representative title; may be null.
      required:
      - domain
      - urls
      additionalProperties: false

    ParsingResultItemDTO:
      type: object
      description: |
        Single parsing result item.
        SSoT: api-contracts.yaml /components/schemas/ParsingResultItemDTO
        
        Note on 'domain' field: This is the hostname extracted from the URL and may
        include subdomains (e.g. 'spb.pulscen.ru'). Server-side filtering uses root
        domain matching against the blacklist - if root domain (e.g. 'pulscen.ru')
        is blacklisted, this item will NOT appear in the response.
      properties:
        url:
          type: string
          format: uri
          title: Url
          description: Full URL of the search result.
        domain:
          type: string
          title: Domain
          description: |
            Hostname from the URL (may include subdomain, e.g. 'spb.pulscen.ru').
            Filtered by root-domain blacklist on server side.
        source:
          $ref: '#/components/schemas/ParsingSource'
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Page title from search results, may be null.
      required:
      - url
      - domain
      - source
      additionalProperties: false

    ParsingResultsByKeyDTO:
      type: object
      description: |
        Parsing results for a single key.
        SSoT: api-contracts.yaml /components/schemas/ParsingResultsByKeyDTO
      properties:
        keyId:
          type: integer
          title: KeyId
        groups:
          type: array
          title: Groups
          items:
            $ref: '#/components/schemas/ParsingDomainGroupDTO'
          description: Domain groups for this key (blacklist-filtered). Each group contains all URLs for that domain.
      required:
      - keyId
      - groups
      additionalProperties: false

    ParsingResultsResponseDTO:
      type: object
      description: |
        Complete parsing results grouped by keyId.
        SSoT: api-contracts.yaml /components/schemas/ParsingResultsResponseDTO
        
        All results are returned at once (no pagination). URLs matching the domain
        blacklist (root domain + subdomains) are excluded and will not appear here.
      properties:
        requestId:
          type: integer
          title: RequestId
        runId:
          type: string
          title: RunId
        results:
          type: array
          title: Results
          items:
            $ref: '#/components/schemas/ParsingResultsByKeyDTO'
          description: Results grouped by keyId.
      required:
      - requestId
      - runId
      - results
      additionalProperties: false

    ModeratorBlacklistUrlItemDTO:
      type: object
      description: |
        Single URL item in the moderator blacklist for a domain.
        SSoT: api-contracts.yaml /components/schemas/ModeratorBlacklistUrlItemDTO
      properties:
        url:
          type: string
          format: uri
          title: Url
          description: Full URL that was blacklisted.
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
          description: Optional comment explaining why this URL was blacklisted.
        createdat:
          type: string
          title: Createdat
          description: Timestamp when this URL was added to blacklist (ISO 8601 format).
      required:
      - url
      - createdat
      additionalProperties: false

    ModeratorBlacklistDomainDTO:
      type: object
      description: |
        Domain entry in the moderator blacklist with associated URLs.
        SSoT: api-contracts.yaml /components/schemas/ModeratorBlacklistDomainDTO
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Hostname/root-domain only, no scheme, no path, no trailing slash.
            Examples: 'cvetmetall.ru', 'pulscen.ru', 'example.com'
        createdat:
          type: string
          title: Createdat
          description: Timestamp when this domain was added to blacklist (ISO 8601 format).
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
          description: Optional comment explaining why this domain was blacklisted.
        urls:
          type: array
          title: Urls
          items:
            $ref: '#/components/schemas/ModeratorBlacklistUrlItemDTO'
          description: List of specific URLs blacklisted for this domain (for accordion UI).
      required:
      - domain
      - createdat
      - urls
      additionalProperties: false

    ModeratorBlacklistDomainListResponseDTO:
      type: object
      description: |
        Response containing list of blacklisted domains with pagination info.
        SSoT: api-contracts.yaml /components/schemas/ModeratorBlacklistDomainListResponseDTO
      properties:
        items:
          type: array
          title: Items
          items:
            $ref: '#/components/schemas/ModeratorBlacklistDomainDTO'
          description: List of blacklisted domains with their URLs.
        limit:
          type: integer
          title: Limit
          description: Maximum number of items requested.
        offset:
          type: integer
          title: Offset
          description: Offset for pagination.
        total:
          type: integer
          title: Total
          description: Total number of blacklisted domains.
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false

    AddModeratorBlacklistDomainRequestDTO:
      type: object
      description: |
        Request to add a domain to the moderator blacklist.
        SSoT: api-contracts.yaml /components/schemas/AddModeratorBlacklistDomainRequestDTO
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Hostname/root-domain only, no scheme, no path, no trailing slash.
            Examples: 'cvetmetall.ru', 'pulscen.ru', 'example.com'
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
          description: Optional comment explaining why this domain is being blacklisted.
        url:
          anyOf:
          - type: string
            format: uri
          - type: 'null'
          title: Url
          description: Optional specific URL to blacklist along with the domain.
      required:
      - domain
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Moderator Parsing Runs (Временные заявки модератора)
    # ==========================================================================
    ModeratorParsingSourceOption:
      type: string
      enum:
      - google
      - yandex
      - both
      title: ModeratorParsingSourceOption
      description: |
        Источник парсинга для ручных запусков модератора.
        - google: только Google
        - yandex: только Яндекс
        - both: оба источника (по умолчанию)
        SSoT: api-contracts.yaml /components/schemas/ModeratorParsingSourceOption

    CreateModeratorParsingRunRequestDTO:
      type: object
      description: |
        Запрос на создание ручного запуска парсинга.
        SSoT: api-contracts.yaml /components/schemas/CreateModeratorParsingRunRequestDTO
        
        ВАЖНО: Backend автоматически добавляет "купить " к ключу при поиске.
        Клиент передаёт только чистый ключ без этого префикса.
      properties:
        key:
          type: string
          minLength: 1
          maxLength: 500
          title: Key
          description: |
            Чистый поисковый ключ БЕЗ префикса "купить".
            Например: "труба стальная 100мм", "подшипник 6205".
            Backend автоматически добавит "купить " при формировании запроса в поисковик.
            Клиент НЕ ДОЛЖЕН передавать префикс "купить" — это приведёт к дублированию.
        depth:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
          title: Depth
          description: |
            Глубина парсинга — количество страниц поисковой выдачи.
            Default: 10, Max: 50.
        source:
          $ref: '#/components/schemas/ModeratorParsingSourceOption'
          default: both
          description: Источник парсинга (google/yandex/both).
      required:
      - key
      additionalProperties: false

    ModeratorParsingRunDTO:
      type: object
      description: |
        Краткая информация о запуске парсинга для списка.
        SSoT: api-contracts.yaml /components/schemas/ModeratorParsingRunDTO
      properties:
        runId:
          type: string
          title: RunId
          description: Уникальный идентификатор запуска.
        requestid:
          anyOf:
          - type: integer
          - type: 'null'
          title: RequestId
          description: ID заявки (user request), если запуск был сделан из конкретной заявки. Null для ручного запуска "без заявки".
        key:
          type: string
          title: Key
          description: |
            Чистый поисковый ключ (без префикса "купить").
            Префикс добавляется backend-ом при парсинге, но не хранится.
        depth:
          type: integer
          title: Depth
          description: Глубина парсинга.
        source:
          $ref: '#/components/schemas/ModeratorParsingSourceOption'
          description: Источник парсинга.
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
          description: Текущий статус запуска.
        itemsFound:
          type: integer
          minimum: 0
          title: ItemsFound
          description: Количество найденных результатов.
        createdat:
          type: string
          format: date-time
          title: CreatedAt
          description: Дата и время создания запуска (ISO 8601).
        completedat:
          anyOf:
          - type: string
            format: date-time
          - type: 'null'
          title: CompletedAt
          description: Дата и время завершения запуска (ISO 8601), null если не завершён.
      required:
      - runId
      - key
      - depth
      - source
      - status
      - itemsFound
      - createdat
      additionalProperties: false

    ModeratorParsingRunListResponseDTO:
      type: object
      description: |
        Ответ со списком запусков парсинга модератора.
        SSoT: api-contracts.yaml /components/schemas/ModeratorParsingRunListResponseDTO
      properties:
        items:
          type: array
          title: Items
          items:
            $ref: '#/components/schemas/ModeratorParsingRunDTO'
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false

    ModeratorParsingRunDetailDTO:
      type: object
      description: |
        Детальная информация о запуске парсинга, включая результаты.
        SSoT: api-contracts.yaml /components/schemas/ModeratorParsingRunDetailDTO
      properties:
        runId:
          type: string
          title: RunId
        requestid:
          anyOf:
          - type: integer
          - type: 'null'
          title: RequestId
          description: ID заявки (user request), если запуск был сделан из конкретной заявки. Null для ручного запуска "без заявки".
        key:
          type: string
          title: Key
          description: Чистый поисковый ключ (без префикса "купить").
        depth:
          type: integer
          title: Depth
        source:
          $ref: '#/components/schemas/ModeratorParsingSourceOption'
        status:
          $ref: '#/components/schemas/ParsingRunStatus'
        itemsFound:
          type: integer
          minimum: 0
          title: ItemsFound
        createdat:
          type: string
          format: date-time
          title: CreatedAt
        completedat:
          anyOf:
          - type: string
            format: date-time
          - type: 'null'
          title: CompletedAt
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
          description: Сообщение об ошибке, если статус failed.
        groups:
          type: array
          title: Groups
          items:
            $ref: '#/components/schemas/ModeratorParsingRunDomainGroupDTO'
          description: |
            Результаты, сгруппированные по доменам (аккордеон для UI).
            Каждый URL содержит информацию о ключе, которым был найден.
            Пустой массив, если парсинг не завершён или нет результатов.
      required:
      - runId
      - key
      - depth
      - source
      - status
      - itemsFound
      - createdat
      - groups
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Moderator Parsing Run URL/Domain Groups (with URL→keys mapping)
    # ==========================================================================
    ModeratorParsingRunUrlDTO:
      type: object
      description: |
        URL в результатах парсинга с информацией о ключах, которые к нему привели.
        Один URL может всплывать по нескольким разным ключам (например, "TEKA ..."
        и "Комбинированная варочная панель ..."), поэтому keys — массив.
        SSoT: api-contracts.yaml /components/schemas/ModeratorParsingRunUrlDTO
      properties:
        url:
          type: string
          format: uri
          title: Url
          description: Полный URL результата.
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Заголовок страницы из поисковой выдачи.
        source:
          $ref: '#/components/schemas/ParsingSource'
          description: Источник (google/yandex).
        keys:
          type: array
          title: Keys
          minItems: 1
          items:
            type: string
          description: |
            Список ключей (чистых, без "купить"), по которым найден этот URL.
            Один URL может всплывать по нескольким ключам — все они перечислены здесь.
      required:
      - url
      - source
      - keys
      additionalProperties: false

    ModeratorParsingRunDomainGroupDTO:
      type: object
      description: |
        Группа результатов парсинга по домену для ручных запусков модератора.
        В отличие от ParsingDomainGroupDTO, содержит объекты URL с привязкой к ключам.
        SSoT: api-contracts.yaml /components/schemas/ModeratorParsingRunDomainGroupDTO
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Root-домен (нормализованный, без www).
            Примеры: 'example.com', 'pulscen.ru'.
        rootdomain:
          type: string
          title: RootDomain
          description: |
            Канонический root-домен для дедупликации.
            Всегда без www, без схемы, без путей.
        urls:
          type: array
          title: Urls
          minItems: 1
          items:
            $ref: '#/components/schemas/ModeratorParsingRunUrlDTO'
          description: Список URL-ов с информацией о ключах.
        source:
          anyOf:
          - $ref: '#/components/schemas/ParsingSource'
          - type: 'null'
          title: Source
          description: Агрегированный источник; null если смешанный (google+yandex).
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Репрезентативный заголовок домена (может быть null).
      required:
      - domain
      - rootdomain
      - urls
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Pending Domains Queue (Очередь доменов ждут решения)
    # ==========================================================================
    UrlKeyHitDTO:
      type: object
      description: |
        Связь URL с поисковым ключом, который к нему привёл.
        SSoT: api-contracts.yaml /components/schemas/UrlKeyHitDTO
      properties:
        key:
          type: string
          title: Key
          description: Чистый поисковый ключ (без префикса "купить").
        hitcount:
          type: integer
          minimum: 1
          title: HitCount
          description: Сколько раз этот ключ приводил к URL.
        lasthitat:
          type: string
          format: date-time
          title: LastHitAt
          description: Время последнего попадания.
      required:
      - key
      - hitcount
      - lasthitat
      additionalProperties: false

    PendingDomainUrlDTO:
      type: object
      description: |
        URL в составе pending-домена с привязкой к ключам.
        SSoT: api-contracts.yaml /components/schemas/PendingDomainUrlDTO
      properties:
        url:
          type: string
          format: uri
          title: Url
        title:
          anyOf:
          - type: string
          - type: 'null'
          title: Title
          description: Заголовок страницы из поисковой выдачи.
        source:
          anyOf:
          - $ref: '#/components/schemas/ParsingSource'
          - type: 'null'
          title: Source
          description: Источник (google/yandex), null если смешанный.
        hitcount:
          type: integer
          minimum: 1
          title: HitCount
          description: Общее количество попаданий по этому URL.
        keys:
          type: array
          title: Keys
          items:
            $ref: '#/components/schemas/UrlKeyHitDTO'
          description: Список ключей, которые привели к этому URL.
      required:
      - url
      - hitcount
      - keys
      additionalProperties: false

    PendingDomainDTO:
      type: object
      description: |
        Домен в очереди ожидания решения (для списка).
        SSoT: api-contracts.yaml /components/schemas/PendingDomainDTO
        
        **Примечание:** Поле `urls` содержит только превью (до 10 URL).
        Для получения полного списка всех URL домена используйте
        `GET /moderator/pending-domains/{domain}`.
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Root-домен в нормализованном виде (без www, без схемы, без путей).
            Примеры: 'example.com', 'pulscen.ru'.
        totalhits:
          type: integer
          minimum: 1
          title: TotalHits
          description: Общее количество попаданий по всем URL домена.
        urlcount:
          type: integer
          minimum: 1
          title: UrlCount
          description: |
            Количество уникальных URL для этого домена.
            Может быть больше, чем длина массива `urls` (который ограничен 10 элементами).
        firstseenat:
          type: string
          format: date-time
          title: FirstSeenAt
          description: Когда домен впервые появился в результатах.
        lasthitat:
          type: string
          format: date-time
          title: LastHitAt
          description: Последнее попадание по домену.
        urls:
          type: array
          title: Urls
          items:
            $ref: '#/components/schemas/PendingDomainUrlDTO'
          description: |
            **Превью** списка URL-ов домена (для аккордеона в UI).
            Ограничено 10 элементами для оптимизации списка.
            Полный список всех URL доступен через `GET /moderator/pending-domains/{domain}`.
          maxItems: 10
      required:
      - domain
      - totalhits
      - urlcount
      - firstseenat
      - lasthitat
      - urls
      additionalProperties: false

    PendingDomainListResponseDTO:
      type: object
      description: |
        Ответ со списком pending-доменов.
        SSoT: api-contracts.yaml /components/schemas/PendingDomainListResponseDTO
      properties:
        items:
          type: array
          title: Items
          items:
            $ref: '#/components/schemas/PendingDomainDTO'
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
          description: Общее количество pending-доменов.
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false

    PendingDomainDetailDTO:
      type: object
      description: |
        Детальная информация о pending-домене.
        SSoT: api-contracts.yaml /components/schemas/PendingDomainDetailDTO
        
        **Отличие от PendingDomainDTO:**
        В отличие от списочного DTO, здесь поле `urls` содержит **полный** список
        всех URL домена без ограничения в 10 элементов.
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Root-домен в нормализованном виде (без www, без схемы, без путей).
        totalhits:
          type: integer
          minimum: 1
          title: TotalHits
        urlcount:
          type: integer
          minimum: 1
          title: UrlCount
        firstseenat:
          type: string
          format: date-time
          title: FirstSeenAt
        lasthitat:
          type: string
          format: date-time
          title: LastHitAt
        urls:
          type: array
          title: Urls
          items:
            $ref: '#/components/schemas/PendingDomainUrlDTO'
          description: |
            **Полный** список всех URL-ов домена (без ограничения).
            Каждый URL содержит привязку к ключам, которые к нему привели.
      required:
      - domain
      - totalhits
      - urlcount
      - firstseenat
      - lasthitat
      - urls
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Domain Decision (Принять решение по домену)
    # ==========================================================================
    DomainDecisionStatus:
      type: string
      enum:
      - supplier
      - reseller
      - blacklist
      - pending
      title: DomainDecisionStatus
      description: |
        Статус решения по домену:
        - supplier: поставщик
        - reseller: реселлер
        - blacklist: чёрный список
        - pending: ожидает решения (сброс)
        SSoT: api-contracts.yaml /components/schemas/DomainDecisionStatus

    SupplierCardType:
      type: string
      enum:
      - supplier
      - reseller
      title: SupplierCardType
      description: |
        Тип карточки контрагента.
        SSoT: api-contracts.yaml /components/schemas/SupplierCardType

    DomainDecisionCardDataDTO:
      type: object
      description: |
        Данные для создания/обновления карточки при решении supplier/reseller.
        Обязательны при status = supplier или reseller.
        SSoT: api-contracts.yaml /components/schemas/DomainDecisionCardDataDTO
      properties:
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
          description: ИНН организации (10 или 12 цифр).
        name:
          type: string
          minLength: 1
          maxLength: 500
          title: Name
          description: Название организации.
        email:
          type: string
          format: email
          title: Email
          description: Контактный email.
        emails:
          anyOf:
          - type: array
            items:
              type: string
              format: email
            maxItems: 10
          - type: 'null'
          title: Emails
          description: Дополнительные email-адреса.
        phone:
          anyOf:
          - type: string
          - type: 'null'
          title: Phone
          description: Контактный телефон.
        comment:
          anyOf:
          - type: string
            maxLength: 2000
          - type: 'null'
          title: Comment
          description: Комментарий модератора.
      required:
      - inn
      - name
      - email
      additionalProperties: false

    DomainDecisionRequestDTO:
      type: object
      description: |
        Запрос на принятие решения по домену.
        SSoT: api-contracts.yaml /components/schemas/DomainDecisionRequestDTO
      properties:
        status:
          $ref: '#/components/schemas/DomainDecisionStatus'
          description: Новый статус домена.
        carddata:
          anyOf:
          - $ref: '#/components/schemas/DomainDecisionCardDataDTO'
          - type: 'null'
          description: |
            Данные карточки. Обязательны при status = supplier или reseller.
            Игнорируются при status = blacklist или pending.
        comment:
          anyOf:
          - type: string
            maxLength: 2000
          - type: 'null'
          title: Comment
          description: Комментарий к решению (для blacklist или общий).
      required:
      - status
      additionalProperties: false

    DomainDecisionResponseDTO:
      type: object
      description: |
        Ответ с информацией о принятом решении.
        SSoT: api-contracts.yaml /components/schemas/DomainDecisionResponseDTO
        
        **Intended flow для UI:**
        Этот ответ содержит базовую информацию о решении и список URL-ов домена.
        Если фронту нужна детализация "какие ключи привели к каждому URL", следует
        дополнительно запросить:
        - `GET /moderator/domains/{domain}/hits` — лог всех ключей для домена
        - `GET /moderator/pending-domains/{domain}` — детали с URL→keys (если домен был pending)
        
        Это разделение позволяет decision endpoint оставаться быстрым и простым.
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Root-домен в нормализованном виде (без www, без схемы, без путей).
            Примеры: 'example.com', 'pulscen.ru'.
        status:
          $ref: '#/components/schemas/DomainDecisionStatus'
        decisionat:
          type: string
          format: date-time
          title: DecisionAt
          description: Дата и время принятия решения.
        supplierid:
          anyOf:
          - type: integer
          - type: 'null'
          title: SupplierId
          description: ID созданной/обновлённой карточки (для supplier/reseller).
        card:
          anyOf:
          - $ref: '#/components/schemas/SupplierCardDTO'
          - type: 'null'
          description: Данные карточки (для supplier/reseller).
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
        urls:
          type: array
          title: Urls
          items:
            type: string
            format: uri
          description: |
            URL-ы, автоматически привязанные к домену/карточке.
            Это простой список URL без детализации по ключам.
            Для получения связи URL→keys используйте `/moderator/domains/{domain}/hits`.
      required:
      - domain
      - status
      - decisionat
      - urls
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Supplier Card (Карточка поставщика/реселлера)
    # ==========================================================================
    CreateSupplierCardRequestDTO:
      type: object
      description: |
        Запрос на создание карточки поставщика/реселлера.
        SSoT: api-contracts.yaml /components/schemas/CreateSupplierCardRequestDTO
      properties:
        type:
          $ref: '#/components/schemas/SupplierCardType'
          default: supplier
          description: Тип карточки.
        inn:
          type: string
          minLength: 10
          maxLength: 12
          title: Inn
        name:
          type: string
          minLength: 1
          maxLength: 500
          title: Name
        email:
          type: string
          format: email
          title: Email
        emails:
          anyOf:
          - type: array
            items:
              type: string
              format: email
            maxItems: 10
          - type: 'null'
          title: Emails
        phone:
          anyOf:
          - type: string
          - type: 'null'
          title: Phone
        urls:
          type: array
          title: Urls
          items:
            type: string
            format: uri
          minItems: 1
          description: Список URL-ов, привязанных к карточке.
        comment:
          anyOf:
          - type: string
            maxLength: 2000
          - type: 'null'
          title: Comment
      required:
      - inn
      - name
      - email
      - urls
      additionalProperties: false

    UpdateSupplierCardRequestDTO:
      type: object
      description: |
        Запрос на обновление карточки поставщика/реселлера.
        Все поля опциональны — обновляются только переданные.
        SSoT: api-contracts.yaml /components/schemas/UpdateSupplierCardRequestDTO
      properties:
        type:
          anyOf:
          - $ref: '#/components/schemas/SupplierCardType'
          - type: 'null'
        name:
          anyOf:
          - type: string
            minLength: 1
            maxLength: 500
          - type: 'null'
          title: Name
        email:
          anyOf:
          - type: string
            format: email
          - type: 'null'
          title: Email
        emails:
          anyOf:
          - type: array
            items:
              type: string
              format: email
            maxItems: 10
          - type: 'null'
          title: Emails
        phone:
          anyOf:
          - type: string
          - type: 'null'
          title: Phone
        urls:
          anyOf:
          - type: array
            items:
              type: string
              format: uri
          - type: 'null'
          title: Urls
        comment:
          anyOf:
          - type: string
            maxLength: 2000
          - type: 'null'
          title: Comment
      additionalProperties: false

    SupplierCardDTO:
      type: object
      description: |
        Карточка поставщика/реселлера.
        SSoT: api-contracts.yaml /components/schemas/SupplierCardDTO
      properties:
        supplierid:
          type: integer
          title: SupplierId
        type:
          $ref: '#/components/schemas/SupplierCardType'
        inn:
          type: string
          title: Inn
        name:
          type: string
          title: Name
        email:
          type: string
          format: email
          title: Email
        emails:
          anyOf:
          - type: array
            items:
              type: string
              format: email
          - type: 'null'
          title: Emails
        phone:
          anyOf:
          - type: string
          - type: 'null'
          title: Phone
        urls:
          type: array
          title: Urls
          items:
            type: string
            format: uri
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
        createdat:
          type: string
          format: date-time
          title: CreatedAt
        updatedat:
          type: string
          format: date-time
          title: UpdatedAt
        checko:
          anyOf:
          - type: object
            additionalProperties: true
          - type: 'null'
          title: Checko
          description: Данные из сервиса проверки контрагентов.
      required:
      - supplierid
      - type
      - inn
      - name
      - email
      - urls
      - createdat
      - updatedat
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Hits Log (Лог попаданий)
    # ==========================================================================
    HitLogEntryDTO:
      type: object
      description: |
        Запись в логе попаданий.
        SSoT: api-contracts.yaml /components/schemas/HitLogEntryDTO
      properties:
        key:
          type: string
          title: Key
          description: Чистый поисковый ключ (без префикса "купить").
        source:
          $ref: '#/components/schemas/ParsingSource'
          description: Источник (google/yandex).
        hitcount:
          type: integer
          minimum: 1
          title: HitCount
          description: Количество попаданий.
        firsthitat:
          type: string
          format: date-time
          title: FirstHitAt
          description: Время первого попадания.
        lasthitat:
          type: string
          format: date-time
          title: LastHitAt
          description: Время последнего попадания.
        runid:
          anyOf:
          - type: string
          - type: 'null'
          title: RunId
          description: ID запуска парсинга (если применимо).
        requestid:
          anyOf:
          - type: integer
          - type: 'null'
          title: RequestId
          description: ID заявки пользователя (если применимо).
      required:
      - key
      - source
      - hitcount
      - firsthitat
      - lasthitat
      additionalProperties: false

    DomainHitsResponseDTO:
      type: object
      description: |
        Ответ с логом попаданий для домена.
        SSoT: api-contracts.yaml /components/schemas/DomainHitsResponseDTO
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Root-домен в нормализованном виде (без www, без схемы, без путей).
        status:
          anyOf:
          - $ref: '#/components/schemas/DomainDecisionStatus'
          - type: 'null'
          description: Текущий статус домена (null если не определён).
        totalhits:
          type: integer
          minimum: 0
          title: TotalHits
          description: Общее количество попаданий.
        hits:
          type: array
          title: Hits
          items:
            $ref: '#/components/schemas/HitLogEntryDTO'
          description: Список записей лога попаданий.
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
          description: Общее количество записей в логе.
      required:
      - domain
      - totalhits
      - hits
      - limit
      - offset
      - total
      additionalProperties: false

    UrlHitsResponseDTO:
      type: object
      description: |
        Ответ с логом попаданий для URL.
        SSoT: api-contracts.yaml /components/schemas/UrlHitsResponseDTO
      properties:
        url:
          type: string
          format: uri
          title: Url
        domain:
          type: string
          title: Domain
          description: |
            Root-домен в нормализованном виде (без www).
            Домен, к которому принадлежит URL.
        domainstatus:
          anyOf:
          - $ref: '#/components/schemas/DomainDecisionStatus'
          - type: 'null'
          description: Текущий статус домена.
        totalhits:
          type: integer
          minimum: 0
          title: TotalHits
        hits:
          type: array
          title: Hits
          items:
            $ref: '#/components/schemas/HitLogEntryDTO'
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - url
      - domain
      - totalhits
      - hits
      - limit
      - offset
      - total
      additionalProperties: false

    # ==========================================================================
    # NEW SCHEMAS: Resolved Domains (История решений)
    # ==========================================================================
    ResolvedDomainDTO:
      type: object
      description: |
        Домен с принятым решением.
        SSoT: api-contracts.yaml /components/schemas/ResolvedDomainDTO
      properties:
        domain:
          type: string
          title: Domain
          description: |
            Root-домен в нормализованном виде (без www, без схемы, без путей).
        status:
          $ref: '#/components/schemas/DomainDecisionStatus'
          description: Статус решения (без pending).
        decisionat:
          type: string
          format: date-time
          title: DecisionAt
        supplierid:
          anyOf:
          - type: integer
          - type: 'null'
          title: SupplierId
          description: ID карточки (для supplier/reseller).
        suppliername:
          anyOf:
          - type: string
          - type: 'null'
          title: SupplierName
          description: Название из карточки (для supplier/reseller).
        urlcount:
          type: integer
          minimum: 0
          title: UrlCount
          description: Количество URL-ов, привязанных к домену.
        totalhits:
          type: integer
          minimum: 0
          title: TotalHits
          description: Общее количество попаданий.
        comment:
          anyOf:
          - type: string
          - type: 'null'
          title: Comment
      required:
      - domain
      - status
      - decisionat
      - urlcount
      - totalhits
      additionalProperties: false

    ResolvedDomainListResponseDTO:
      type: object
      description: |
        Ответ со списком resolved-доменов.
        SSoT: api-contracts.yaml /components/schemas/ResolvedDomainListResponseDTO
      properties:
        items:
          type: array
          title: Items
          items:
            $ref: '#/components/schemas/ResolvedDomainDTO'
        limit:
          type: integer
          title: Limit
        offset:
          type: integer
          title: Offset
        total:
          type: integer
          title: Total
      required:
      - items
      - limit
      - offset
      - total
      additionalProperties: false
