# PROJECT-DOC — пояснялка (RU, NOT SSoT)

Оригинал правил — PROJECT-DOC.md. Тут коротко “как понимать” и “на что это влияет” (без попытки быть контрактом). [NOT SSoT]

---

## Зачем этот документ вообще

PROJECT-DOC фиксирует продуктовые правила, которые **не описаны** в OpenAPI-контрактах. [file:37]
Если правило не зафиксировано — потом начинаются бесконечные вопросы и переделки. [file:37]

---

## Основной поток (очень по‑простому)

1) Пользователь создаёт Request + список “ключей/позиций”. [file:37]
2) Жмёт “Получить контакты поставщиков”:
   - запускается matching по базе,
   - создаётся задача модератору. [file:37]
3) Модератор запускает парсер по ключам (Google/Yandex) и получает список URL. [file:37]
4) Дальше URL либо сразу “доставляются” (если уже есть модерированный поставщик), либо идут на модерацию и после подтверждения попадают пользователю. [file:37]

---

## Что такое “модерированный поставщик” (важно)

Поставщик считается пригодным для автоматической выдачи пользователю только если модератор привязал минимум: URL, ИНН, название, email отдела продаж. [file:37]
Пока этого нет — URL может существовать, но он “не готов” и не должен автоматом попадать пользователям как поставщик. [file:37]

---

## Matching “похожего ключа” (MVP)

MVP‑логика должна быть детерминированной и объяснимой:
- Нормализация текста (нижний регистр, пробелы, d/ø/д, ё/е). [file:37]
- Выделение обязательных параметров (например d=100, ГОСТ и т.п.). [file:37]
- Совпадение: обязательные параметры совпали + похожесть текста выше порога. [file:37]
- Храним “почему совпало”, чтобы это не было чёрным ящиком. [file:37]

---

## Статусы/цвета поставщика в ЛК (как их понимать)

- Серый: ИНН поставщика в личном ЧС пользователя → показываем, но чекбокс “отправлять” по умолчанию выключен. [file:37]
- Фиолетовый: “перекупщик” (глобальная метка) → чекбокс по умолчанию выключен. [file:37]
- Жёлтый: новый поставщик после модерации → пока пользователь явно не снимет галочку или не отправит запрос. [file:37]
- Красный: запрос не отправлен (обычное стартовое). [file:37]
- Зелёный: запрос отправлен. [file:37]
Плюс нужна индикация “ответил/не ответил” (позже). [file:37]

---

## MVP‑ограничение по почте

Пока почта пользователя не интегрирована, “отправка из сервиса” не работает (заглушка). [file:37]
Пользователь копирует контакты и отправляет из своей почты, а статусы до интеграции могут быть заглушками. [file:37]

---

## Поставщики: важные ограничения данных

- ИНН у поставщика строго один. [file:37]
- URL у поставщика может быть несколько. [file:37]
- Один URL не может принадлежать двум поставщикам (глобальная уникальность). [file:37]
- Поиск поставщиков: модераторский инструмент; видимость для пользователя — через фича‑флаг (по умолчанию скрыто). [file:37]

---

## Дубли по ИНН (модератор)

Если модератор создаёт поставщика с ИНН, который уже есть — создание блокируется. [file:37]
API должен вернуть 409 Duplicate INN, а UI открыть экран сравнения дубля и дать действие “перейти в карточку существующей компании”. [file:37]

---

## Модерация результатов парсинга (самое важное)

### Blacklist (глобальный спам‑лист доменов)
- “Чёрный” в модерации = глобальный Blacklist спам‑доменов. [file:37]
- Храним **корневой домен** (пример: pulscen.ru). [file:37]
- Бан корневого домена режет и домен, и любые поддомены (spb.pulscen.ru и т.д.). [file:37]
- Если URL в Blacklist:
  - модератор не должен видеть его в результатах парсинга,
  - пользователь не должен получить поставщика из такого URL,
  - URL остаётся только в служебных логах/списке. [file:37]

### Перекупщики (Resellers)
- Перекупщик — это НЕ blacklist. [file:37]
- URL можно смодерировать и добавить в базу, но пометить как reseller (например is_reseller=true). [file:37]
- Показываем и модератору, и пользователю (с явной меткой), решение “отправлять/не отправлять” остаётся за пользователем. [file:37]

### “Галочки” пользователя (Recipients)
- Галочки — это выбор получателей в личном кабинете пользователя, не на этапе парсинга. [file:37]
- По сути это массив {supplier_id, selected} для конкретного request. [file:37]

### Поддомены: правило семейства
- Если в базе есть корневой домен (example.com), поддомены считаются тем же “семейством”. [file:37]
- Это нужно, чтобы не плодить дубликаты и чтобы инфа по корню применялась к поддоменам (если нет более точного совпадения). [file:37]