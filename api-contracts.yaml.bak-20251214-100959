openapi: 3.0.3
info:
  title: B2B Platform API
  version: 1.0.0
  description: >
    B2B procurement platform API: requests, keys, suppliers, moderation, email sending,
    inbound reply tracking. Attachments are uploaded separately and referenced by ID.

servers:
  - url: http://localhost:8000/api/v1
    description: Local
  - url: https://{host}/api/v1
    description: Production
    variables:
      host:
        default: app.example.com

tags:
  - name: Auth
  - name: UserRequests
  - name: Suppliers
  - name: Attachments
  - name: UserMessaging
  - name: ModeratorTasks
  - name: ModeratorSuppliers
  - name: Blacklist
  - name: System

security:
  - bearerAuth: []

paths:
  /health:
    get:
      tags: [System]
      summary: Health check
      security: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  # ----------------------------
  # AUTH
  # ----------------------------
  /auth/oauth/google/start:
    get:
      tags: [Auth]
      summary: Start Google OAuth login
      security: []
      responses:
        "302":
          description: Redirect to OAuth provider

  /auth/oauth/google/callback:
    get:
      tags: [Auth]
      summary: OAuth callback (Google)
      security: []
      parameters:
        - in: query
          name: code
          required: true
          schema: { type: string }
      responses:
        "200":
          description: JWT issued
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokenResponse"

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema: { $ref: "#/components/schemas/User" }

  /auth/policy:
    put:
      tags: [Auth]
      summary: Update email deletion policy
      description: >
        append_only = user cannot delete messages in UI (system remains append-only and auditable).
        allow_delete = user can hide (soft-delete) messages for their view.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateEmailPolicyRequest" }
      responses:
        "200":
          description: Updated user
          content:
            application/json:
              schema: { $ref: "#/components/schemas/User" }

  # ----------------------------
  # REQUESTS
  # ----------------------------
  /user/upload-and-create:
    post:
      tags: [UserRequests]
      summary: Upload procurement file and create a draft request
      description: >
        Accepts PDF/DOCX/XLSX/TXT. For PDF: only up to PDF_MAX_PAGES pages are processed via LLM.
        DOCX/XLSX parsed with free parsers (no tokens).
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: Draft request created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CreateRequestResponse" }
        "413":
          description: File too large / too many pages
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /user/requests:
    get:
      tags: [UserRequests]
      summary: List user requests
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: List of requests
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RequestListResponse" }

    post:
      tags: [UserRequests]
      summary: Create a draft request from manual keys (no file)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateRequestManualRequest" }
      responses:
        "200":
          description: Draft request created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CreateRequestResponse" }

  /user/requests/{requestId}:
    get:
      tags: [UserRequests]
      summary: Get request detail (keys + suppliers + statuses)
      parameters:
        - $ref: "#/components/parameters/RequestId"
      responses:
        "200":
          description: Request detail
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RequestDetail" }
        "404":
          description: Not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /user/requests/{requestId}/keys:
    put:
      tags: [UserRequests]
      summary: Update/confirm keys for a draft request (after parsing)
      parameters:
        - $ref: "#/components/parameters/RequestId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateRequestKeysRequest" }
      responses:
        "200":
          description: Updated request keys
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RequestDetail" }

  /user/requests/{requestId}/submit:
    post:
      tags: [UserRequests]
      summary: Submit request (start matching + create moderation tasks)
      description: >
        Matches suppliers by keys (exact + pg_trgm; embeddings later) and creates moderation tasks.
      parameters:
        - $ref: "#/components/parameters/RequestId"
      responses:
        "200":
          description: Submitted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/SubmitRequestResponse" }
        "400":
          description: Invalid state (e.g., not draft)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ----------------------------
  # SUPPLIERS
  # ----------------------------
  /suppliers/search:
    get:
      tags: [Suppliers]
      summary: Search suppliers by query
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string, minLength: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema: { $ref: "#/components/schemas/SupplierSearchResponse" }

  # ----------------------------
  # ATTACHMENTS (correct way)
  # ----------------------------
  /user/attachments:
    post:
      tags: [Attachments]
      summary: Upload an attachment (for email sending)
      description: >
        Uploads a file and returns attachment_id. Later used in /send endpoints.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                title:
                  type: string
                  description: Optional display name
      responses:
        "200":
          description: Attachment uploaded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Attachment" }
        "413":
          description: Attachment too large
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Attachments]
      summary: List user attachments
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: Attachments
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AttachmentListResponse" }

  /user/attachments/{attachmentId}:
    get:
      tags: [Attachments]
      summary: Get attachment metadata
      parameters:
        - $ref: "#/components/parameters/AttachmentId"
      responses:
        "200":
          description: Attachment
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Attachment" }

    delete:
      tags: [Attachments]
      summary: Delete attachment (soft delete)
      parameters:
        - $ref: "#/components/parameters/AttachmentId"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/GenericOkResponse" }

  /user/attachments/{attachmentId}/download:
    get:
      tags: [Attachments]
      summary: Download attachment file
      parameters:
        - $ref: "#/components/parameters/AttachmentId"
      responses:
        "200":
          description: File stream
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  # ----------------------------
  # USER MESSAGING (send + replies)
  # ----------------------------
  /user/requests/{requestId}/recipients:
    put:
      tags: [UserMessaging]
      summary: Set selected recipients (checkboxes) for the request
      parameters:
        - $ref: "#/components/parameters/RequestId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateRecipientsRequest" }
      responses:
        "200":
          description: Updated recipients
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RecipientsResponse" }

  /user/requests/{requestId}/send:
    post:
      tags: [UserMessaging]
      summary: Send inquiry emails to selected suppliers
      description: >
        Sends one email per supplier per request (unique requestId+supplierId).
        Attachments are passed as attachment_ids.
      parameters:
        - $ref: "#/components/parameters/RequestId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/SendMessageRequestV2" }
      responses:
        "200":
          description: Send started / completed
          content:
            application/json:
              schema: { $ref: "#/components/schemas/SendMessageResponse" }
        "409":
          description: Already sent to some suppliers
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /user/requests/{requestId}/send-new:
    post:
      tags: [UserMessaging]
      summary: Send only to new suppliers (yellow status)
      parameters:
        - $ref: "#/components/parameters/RequestId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/SendMessageRequestV2" }
      responses:
        "200":
          description: Send started / completed
          content:
            application/json:
              schema: { $ref: "#/components/schemas/SendMessageResponse" }

  /user/requests/{requestId}/messages:
    get:
      tags: [UserMessaging]
      summary: List messages (thread) for the request (only the user can see)
      parameters:
        - $ref: "#/components/parameters/RequestId"
        - in: query
          name: limit
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
        - in: query
          name: include_deleted
          schema: { type: boolean, default: false }
      responses:
        "200":
          description: Messages
          content:
            application/json:
              schema: { $ref: "#/components/schemas/MessageListResponse" }

  /user/messages/{messageId}:
    delete:
      tags: [UserMessaging]
      summary: Delete message (soft delete) if email_policy=allow_delete
      description: >
        In append_only mode returns 403.
        Deletion is soft (hidden for the user), audit stays.
      parameters:
        - $ref: "#/components/parameters/MessageId"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/GenericOkResponse" }
        "403":
          description: Not allowed by policy
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ----------------------------
  # MODERATOR TASKS
  # ----------------------------
  /moderator/tasks:
    get:
      tags: [ModeratorTasks]
      summary: List moderation tasks
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, parsed, needs_manual, done]
        - in: query
          name: limit
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
      responses:
        "200":
          description: Tasks
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ModeratorTaskListResponse" }

  /moderator/tasks/{taskId}:
    get:
      tags: [ModeratorTasks]
      summary: Get moderation task detail
      parameters:
        - $ref: "#/components/parameters/TaskId"
      responses:
        "200":
          description: Task detail
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ModeratorTaskDetail" }

  /moderator/requests/{requestId}/start-parsing:
    post:
      tags: [ModeratorTasks]
      summary: Start parsing URLs for a submitted request
      parameters:
        - $ref: "#/components/parameters/RequestId"
      responses:
        "200":
          description: Parsing started
          content:
            application/json:
              schema: { $ref: "#/components/schemas/GenericOkResponse" }

  # ----------------------------
  # MODERATOR SUPPLIERS (database view + create)
  # ----------------------------
  /moderator/suppliers:
    get:
      tags: [ModeratorSuppliers]
      summary: Browse/search suppliers database (moderator view)
      parameters:
        - in: query
          name: q
          schema: { type: string, description: "Search by name/INN/domain/key" }
        - in: query
          name: limit
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: Suppliers
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ModeratorSupplierListResponse" }

    post:
      tags: [ModeratorSuppliers]
      summary: Add supplier to database (moderated)
      description: >
        Required fields: url_original, name, inn. After creation, enrich via Checko API.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateSupplierRequest" }
      responses:
        "200":
          description: Supplier created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Supplier" }

  /moderator/suppliers/{supplierId}:
    get:
      tags: [ModeratorSuppliers]
      summary: Get supplier detail (with Checko data)
      parameters:
        - $ref: "#/components/parameters/SupplierId"
      responses:
        "200":
          description: Supplier
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Supplier" }

    put:
      tags: [ModeratorSuppliers]
      summary: Update supplier (e.g., refresh Checko data)
      parameters:
        - $ref: "#/components/parameters/SupplierId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateSupplierRequest" }
      responses:
        "200":
          description: Updated supplier
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Supplier" }

  # ----------------------------
  # BLACKLIST
  # ----------------------------
  /moderator/blacklist/domains:
    post:
      tags: [Blacklist]
      summary: Add domain to blacklist (ban entire domain)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/AddBlacklistDomainRequest" }
      responses:
        "200":
          description: Added
          content:
            application/json:
              schema: { $ref: "#/components/schemas/GenericOkResponse" }

    get:
      tags: [Blacklist]
      summary: List blacklisted domains
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 200, minimum: 1, maximum: 500 }
      responses:
        "200":
          description: Blacklist
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BlacklistDomainListResponse" }

  /moderator/blacklist/domains/{domain}:
    delete:
      tags: [Blacklist]
      summary: Remove domain from blacklist (unban)
      parameters:
        - in: path
          name: domain
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Removed
          content:
            application/json:
              schema: { $ref: "#/components/schemas/GenericOkResponse" }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    RequestId:
      in: path
      name: requestId
      required: true
      schema: { type: integer, minimum: 1 }
    TaskId:
      in: path
      name: taskId
      required: true
      schema: { type: integer, minimum: 1 }
    SupplierId:
      in: path
      name: supplierId
      required: true
      schema: { type: integer, minimum: 1 }
    AttachmentId:
      in: path
      name: attachmentId
      required: true
      schema: { type: integer, minimum: 1 }
    MessageId:
      in: path
      name: messageId
      required: true
      schema: { type: integer, minimum: 1 }

  schemas:
    HealthResponse:
      type: object
      properties:
        status: { type: string, example: ok }
      required: [status]

    ErrorResponse:
      type: object
      properties:
        success: { type: boolean, example: false }
        error: { type: string }
        details:
          type: object
          additionalProperties: true
      required: [success, error]

    GenericOkResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
      required: [success]

    AuthTokenResponse:
      type: object
      properties:
        access_token: { type: string }
        token_type: { type: string, example: Bearer }
        expires_in: { type: integer, example: 3600 }
      required: [access_token, token_type]

    User:
      type: object
      properties:
        id: { type: integer }
        email: { type: string, format: email }
        email_policy:
          type: string
          enum: [append_only, allow_delete]
        created_at: { type: string, format: date-time }
      required: [id, email, email_policy]

    UpdateEmailPolicyRequest:
      type: object
      properties:
        email_policy:
          type: string
          enum: [append_only, allow_delete]
      required: [email_policy]

    CreateRequestManualRequest:
      type: object
      properties:
        title: { type: string, example: "Р вЂ”Р В°РЎРЏР Р†Р С”Р В° Р Р…Р В° Р В·Р В°Р С”РЎС“Р С—Р С”РЎС“ РІвЂћвЂ“123" }
        keys:
          type: array
          items: { $ref: "#/components/schemas/RequestKeyInput" }
      required: [keys]

    CreateRequestResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        request_id: { type: integer }
        filename: { type: string, nullable: true }
        status:
          type: string
          enum: [draft, confirmed, processing, done]
        message: { type: string }
      required: [success, request_id, status]

    RequestListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/RequestSummary" }
        limit: { type: integer }
        offset: { type: integer }
        total: { type: integer }
      required: [items]

    RequestSummary:
      type: object
      properties:
        id: { type: integer }
        filename: { type: string, nullable: true }
        status:
          type: string
          enum: [draft, confirmed, processing, done]
        created_at: { type: string, format: date-time }
        keys_count: { type: integer, example: 5 }
      required: [id, status, created_at]

    RequestKeyInput:
      type: object
      properties:
        pos: { type: integer, minimum: 1 }
        text: { type: string, minLength: 1 }
        qty: { type: number, nullable: true }
        unit: { type: string, nullable: true }
      required: [pos, text]

    UpdateRequestKeysRequest:
      type: object
      properties:
        keys:
          type: array
          items: { $ref: "#/components/schemas/RequestKeyInput" }
      required: [keys]

    SubmitRequestResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        request_id: { type: integer }
        new_status:
          type: string
          enum: [confirmed, processing, done]
        matched_suppliers: { type: integer }
        message: { type: string }
      required: [success, request_id, new_status]

    RequestDetail:
      type: object
      properties:
        id: { type: integer }
        filename: { type: string, nullable: true }
        status:
          type: string
          enum: [draft, confirmed, processing, done]
        created_at: { type: string, format: date-time }
        keys:
          type: array
          items: { $ref: "#/components/schemas/RequestKey" }
      required: [id, status, created_at, keys]

    RequestKey:
      type: object
      properties:
        id: { type: integer }
        pos: { type: integer }
        raw_text: { type: string }
        normalized_text: { type: string }
        qty: { type: number, nullable: true }
        unit: { type: string, nullable: true }
        suppliers:
          type: array
          items: { $ref: "#/components/schemas/SupplierInRequest" }
      required: [id, pos, raw_text, normalized_text, suppliers]

    Supplier:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        inn: { type: string }
        domain_normalized: { type: string }
        url_original: { type: string, nullable: true }

        emails:
          type: array
          description: "Sales contact emails for the supplier (one or more)."
          items:
            type: string
            format: email
          nullable: true

        checko_data:
          type: object
          nullable: true
          additionalProperties: true
        created_at: { type: string, format: date-time }
      required: [id, name, inn, domain_normalized, created_at]
    SupplierInRequest:
      allOf:
        - $ref: "#/components/schemas/Supplier"
        - type: object
          properties:
            is_new: { type: boolean }
            selected: { type: boolean }
            send_status:
              type: string
              enum: [not_sent, sending, sent, failed]
            reply_status:
              type: string
              enum: [no_reply, replied, bounced]
            sent_at: { type: string, format: date-time, nullable: true }
            replied_at: { type: string, format: date-time, nullable: true }
          required: [is_new, selected, send_status, reply_status]

    SupplierSearchResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/Supplier" }
      required: [items]

    # -------- Attachments --------
    Attachment:
      type: object
      properties:
        id: { type: integer }
        title: { type: string, nullable: true }
        original_filename: { type: string }
        content_type: { type: string, nullable: true }
        size_bytes: { type: integer }
        sha256: { type: string, nullable: true }
        storage_key:
          type: string
          description: Internal storage reference (not shown in UI usually)
        is_deleted: { type: boolean, default: false }
        created_at: { type: string, format: date-time }
      required: [id, original_filename, size_bytes, is_deleted, created_at]

    AttachmentListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/Attachment" }
        limit: { type: integer }
        offset: { type: integer }
        total: { type: integer }
      required: [items]

    # -------- Messaging --------
    UpdateRecipientsRequest:
      type: object
      properties:
        recipients:
          type: array
          items:
            type: object
            required: [supplier_id, selected]
            properties:
              supplier_id: { type: integer }
              selected: { type: boolean }
      required: [recipients]

    RecipientsResponse:
      type: object
      properties:
        request_id: { type: integer }
        recipients:
          type: array
          items:
            type: object
            required: [supplier_id, selected, send_status, reply_status, is_new]
            properties:
              supplier_id: { type: integer }
              selected: { type: boolean }
              send_status:
                type: string
                enum: [not_sent, sending, sent, failed]
              reply_status:
                type: string
                enum: [no_reply, replied, bounced]
              is_new: { type: boolean }
      required: [request_id, recipients]

    SendMessageRequestV2:
      type: object
      properties:
        subject: { type: string, minLength: 1 }
        body: { type: string, minLength: 1 }
        attach_request_file:
          type: boolean
          default: true
          description: Attach original request file if present
        attachment_ids:
          type: array
          items: { type: integer }
          description: Additional uploaded attachments to include
      required: [subject, body]

    SendMessageResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        request_id: { type: integer }
        sent_count: { type: integer }
        skipped_already_sent: { type: integer }
        failed_count: { type: integer }
      required: [success, request_id]

    MessageListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/Message" }
        limit: { type: integer }
        offset: { type: integer }
        total: { type: integer }
      required: [items]

    Message:
      type: object
      properties:
        id: { type: integer }
        request_id: { type: integer }
        supplier_id: { type: integer, nullable: true }
        direction:
          type: string
          enum: [outgoing, incoming]
        subject: { type: string }
        body_preview: { type: string }
        message_id: { type: string, nullable: true }
        in_reply_to: { type: string, nullable: true }
        is_deleted_by_user:
          type: boolean
          default: false
          description: Soft delete flag for allow_delete policy
        created_at: { type: string, format: date-time }
      required: [id, request_id, direction, subject, created_at]

    # -------- Moderator tasks / suppliers --------
    ModeratorTaskListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/ModeratorTaskSummary" }
      required: [items]

    ModeratorTaskSummary:
      type: object
      properties:
        id: { type: integer }
        request_id: { type: integer }
        request_key_id: { type: integer }
        url_original: { type: string }
        status:
          type: string
          enum: [pending, parsed, needs_manual, done]
        created_at: { type: string, format: date-time }
      required: [id, request_id, request_key_id, url_original, status, created_at]

    ModeratorTaskDetail:
      allOf:
        - $ref: "#/components/schemas/ModeratorTaskSummary"
        - type: object
          properties:
            notes: { type: string, nullable: true }

    CreateSupplierRequest:
      type: object
      properties:
        name: { type: string, minLength: 1 }
        inn: { type: string, minLength: 10, maxLength: 12 }
        url_original: { type: string, minLength: 3 }

        emails:
          type: array
          items:
            type: string
            format: email
          nullable: true
      required: [name, inn, url_original]
    UpdateSupplierRequest:
      type: object
      properties:
        name: { type: string }
        inn: { type: string }
        url_original: { type: string }

        emails:
          type: array
          items:
            type: string
            format: email
          nullable: true

        refresh_checko:
          type: boolean
          default: false
      additionalProperties: false
    ModeratorSupplierListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/Supplier" }
        limit: { type: integer }
        offset: { type: integer }
        total: { type: integer }
      required: [items]

    # -------- Blacklist --------
    AddBlacklistDomainRequest:
      type: object
      properties:
        domain_canonical:
          type: string
          example: pulsecen.ru
        reason:
          type: string
          nullable: true
      required: [domain_canonical]

    BlacklistDomainListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              domain_canonical: { type: string }
              reason: { type: string, nullable: true }
              created_at: { type: string, format: date-time }
            required: [id, domain_canonical, created_at]
      required: [items]
